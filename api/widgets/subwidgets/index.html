
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Cryo-ET image analysis tool for cylindric periodic structures such as microtubules.">
      
      
      
      
        <link rel="prev" href="../sta/">
      
      
        <link rel="next" href="../batch/">
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.26">
    
    
      
        <title>cylindra.widgets.subwidgets - Cylindra</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.6543a935.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="lime" data-md-color-accent="light-green">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#cylindrawidgetssubwidgets" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="Cylindra" class="md-header__button md-logo" aria-label="Cylindra" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Cylindra
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              cylindra.widgets.subwidgets
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="lime" data-md-color-accent="light-green"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="lime" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/hanjinliu/cylindra" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    cylindra
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Cylindra" class="md-nav__button md-logo" aria-label="Cylindra" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Cylindra
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/hanjinliu/cylindra" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    cylindra
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../installation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Installation
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../basics/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Basics
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Usage
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Usage
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../open_image/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Start Cylindra
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../fit_splines/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Fit Splines
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lattice_params/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Measure Lattice Parameters
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../inspect_results/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Inspect CFT Results
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../project_io/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Load &amp; Save Projects
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../workflows/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Custom Workflows
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_7" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../spline/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Spline
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_7" id="__nav_4_7_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_7">
            <span class="md-nav__icon md-icon"></span>
            Spline
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../spline/clip/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Clip and Invert Splines
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../spline/config/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Spline Configurations
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_8" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../molecules/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Molecules
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_8" id="__nav_4_8_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_8">
            <span class="md-nav__icon md-icon"></span>
            Molecules
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../molecules/spline_to_molecules/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Spline to Molecules
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../molecules/features/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Molecule Features
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../molecules/expressions/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    The "Expressions"
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../molecules/split_and_combine/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Split &amp; Combine Molecules
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../molecules/filter_molecules/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Filter Molecules by Features
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../molecules/transform/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Transform Molecules
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../molecules/headers/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Feature Names
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_9" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../alignment/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Alignment
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_9" id="__nav_4_9_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_9">
            <span class="md-nav__icon md-icon"></span>
            Alignment
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../alignment/conventional/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Conventional Methods in Cryo-ET Studies
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../alignment/landscape/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Build Correlation Landscapes
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../alignment/viterbi/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Viterbi Alignment
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../alignment/rma/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Restricted Mesh Annealing (RMA)
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_10" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../batch/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Working with Many Projects
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_10" id="__nav_4_10_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_10">
            <span class="md-nav__icon md-icon"></span>
            Working with Many Projects
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../batch/collect_projects/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Collect projects
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../batch/construct/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Construct Batch Loaders
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../batch/average/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Average Across Projects
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_11" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../extern/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Working with External Softwares
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_11" id="__nav_4_11_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_11">
            <span class="md-nav__icon md-icon"></span>
            Working with External Softwares
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../extern/imod/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    IMOD
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../extern/relion/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    RELION
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../process_images/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Process Images
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../simulate/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Simulate Tomograms
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cli/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CLI Usage
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_15" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../case_studies/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Case Studies
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_15" id="__nav_4_15_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_15_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_15">
            <span class="md-nav__icon md-icon"></span>
            Case Studies
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../case_studies/seam_search/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Microtubule Seam-search
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../case_studies/ssta/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Segmented Subtomogram Averaging (SSTA)
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" checked>
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    API References
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5" id="__nav_5_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            API References
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../components/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    cylindra.components
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../core/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    cylindra.core
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../project/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    cylindra.project
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cylmeasure/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    cylindra.cylmeasure
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cylfilters/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    cylindra.cylfilters
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ext/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    cylindra.ext
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_8" checked>
        
          
          <label class="md-nav__link" for="__nav_5_8" id="__nav_5_8_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Widgets
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_8_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5_8">
            <span class="md-nav__icon md-icon"></span>
            Widgets
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../main/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    cylindra.widgets.main.CylindraMainWidget
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../sta/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    cylindra.widgets.sta.SubtomogramAveraging
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    cylindra.widgets.subwidgets
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    cylindra.widgets.subwidgets
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#simulator" class="md-nav__link">
    <span class="md-ellipsis">
      Simulator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Simulator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cylindra.widgets.subwidgets.Simulator" class="md-nav__link">
    <span class="md-ellipsis">
      Simulator
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cylindra.widgets.subwidgets.Simulator.add_component" class="md-nav__link">
    <span class="md-ellipsis">
      add_component
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cylindra.widgets.subwidgets.Simulator.create_empty_image" class="md-nav__link">
    <span class="md-ellipsis">
      create_empty_image
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cylindra.widgets.subwidgets.Simulator.create_image_with_straight_line" class="md-nav__link">
    <span class="md-ellipsis">
      create_image_with_straight_line
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cylindra.widgets.subwidgets.Simulator.create_straight_line" class="md-nav__link">
    <span class="md-ellipsis">
      create_straight_line
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cylindra.widgets.subwidgets.Simulator.dilate" class="md-nav__link">
    <span class="md-ellipsis">
      dilate
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cylindra.widgets.subwidgets.Simulator.displace" class="md-nav__link">
    <span class="md-ellipsis">
      displace
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cylindra.widgets.subwidgets.Simulator.expand" class="md-nav__link">
    <span class="md-ellipsis">
      expand
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cylindra.widgets.subwidgets.Simulator.generate_molecules" class="md-nav__link">
    <span class="md-ellipsis">
      generate_molecules
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cylindra.widgets.subwidgets.Simulator.simulate_projection" class="md-nav__link">
    <span class="md-ellipsis">
      simulate_projection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cylindra.widgets.subwidgets.Simulator.simulate_tilt_series" class="md-nav__link">
    <span class="md-ellipsis">
      simulate_tilt_series
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cylindra.widgets.subwidgets.Simulator.simulate_tomogram" class="md-nav__link">
    <span class="md-ellipsis">
      simulate_tomogram
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cylindra.widgets.subwidgets.Simulator.simulate_tomogram_and_open" class="md-nav__link">
    <span class="md-ellipsis">
      simulate_tomogram_and_open
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cylindra.widgets.subwidgets.Simulator.simulate_tomogram_from_tilt_series" class="md-nav__link">
    <span class="md-ellipsis">
      simulate_tomogram_from_tilt_series
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cylindra.widgets.subwidgets.Simulator.twist" class="md-nav__link">
    <span class="md-ellipsis">
      twist
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../batch/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    cylindra.widgets.batch
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#simulator" class="md-nav__link">
    <span class="md-ellipsis">
      Simulator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Simulator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cylindra.widgets.subwidgets.Simulator" class="md-nav__link">
    <span class="md-ellipsis">
      Simulator
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cylindra.widgets.subwidgets.Simulator.add_component" class="md-nav__link">
    <span class="md-ellipsis">
      add_component
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cylindra.widgets.subwidgets.Simulator.create_empty_image" class="md-nav__link">
    <span class="md-ellipsis">
      create_empty_image
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cylindra.widgets.subwidgets.Simulator.create_image_with_straight_line" class="md-nav__link">
    <span class="md-ellipsis">
      create_image_with_straight_line
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cylindra.widgets.subwidgets.Simulator.create_straight_line" class="md-nav__link">
    <span class="md-ellipsis">
      create_straight_line
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cylindra.widgets.subwidgets.Simulator.dilate" class="md-nav__link">
    <span class="md-ellipsis">
      dilate
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cylindra.widgets.subwidgets.Simulator.displace" class="md-nav__link">
    <span class="md-ellipsis">
      displace
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cylindra.widgets.subwidgets.Simulator.expand" class="md-nav__link">
    <span class="md-ellipsis">
      expand
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cylindra.widgets.subwidgets.Simulator.generate_molecules" class="md-nav__link">
    <span class="md-ellipsis">
      generate_molecules
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cylindra.widgets.subwidgets.Simulator.simulate_projection" class="md-nav__link">
    <span class="md-ellipsis">
      simulate_projection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cylindra.widgets.subwidgets.Simulator.simulate_tilt_series" class="md-nav__link">
    <span class="md-ellipsis">
      simulate_tilt_series
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cylindra.widgets.subwidgets.Simulator.simulate_tomogram" class="md-nav__link">
    <span class="md-ellipsis">
      simulate_tomogram
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cylindra.widgets.subwidgets.Simulator.simulate_tomogram_and_open" class="md-nav__link">
    <span class="md-ellipsis">
      simulate_tomogram_and_open
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cylindra.widgets.subwidgets.Simulator.simulate_tomogram_from_tilt_series" class="md-nav__link">
    <span class="md-ellipsis">
      simulate_tomogram_from_tilt_series
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cylindra.widgets.subwidgets.Simulator.twist" class="md-nav__link">
    <span class="md-ellipsis">
      twist
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="cylindrawidgetssubwidgets">cylindra.widgets.subwidgets</h1>
<h2 id="simulator">Simulator</h2>
<p>Methods are available in the namespace <code>ui.simulator</code>.</p>


<div class="doc doc-object doc-class">



<a id="cylindra.widgets.subwidgets.Simulator"></a>
    <div class="doc doc-contents first">


              <details class="quote">
                <summary>Source code in <code>cylindra/widgets/subwidgets/simulator.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span>
<span class="normal">865</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@magicclass</span><span class="p">(</span><span class="n">use_native_menubar</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">Simulator</span><span class="p">(</span><span class="n">ChildWidget</span><span class="p">):</span>
    <span class="nd">@magicmenu</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Create&quot;</span><span class="p">)</span>
    <span class="k">class</span> <span class="nc">CreateMenu</span><span class="p">(</span><span class="n">ChildWidget</span><span class="p">):</span>
        <span class="n">create_empty_image</span> <span class="o">=</span> <span class="n">abstractapi</span><span class="p">()</span>
        <span class="n">create_straight_line</span> <span class="o">=</span> <span class="n">abstractapi</span><span class="p">()</span>
        <span class="n">create_image_with_straight_line</span> <span class="o">=</span> <span class="n">abstractapi</span><span class="p">()</span>

    <span class="nd">@magicmenu</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Simulate&quot;</span><span class="p">)</span>
    <span class="k">class</span> <span class="nc">SimulateMenu</span><span class="p">(</span><span class="n">ChildWidget</span><span class="p">):</span>
        <span class="n">simulate_tomogram</span> <span class="o">=</span> <span class="n">abstractapi</span><span class="p">()</span>
        <span class="n">simulate_tomogram_from_tilt_series</span> <span class="o">=</span> <span class="n">abstractapi</span><span class="p">()</span>
        <span class="n">simulate_tomogram_and_open</span> <span class="o">=</span> <span class="n">abstractapi</span><span class="p">()</span>
        <span class="n">simulate_tilt_series</span> <span class="o">=</span> <span class="n">abstractapi</span><span class="p">()</span>
        <span class="n">simulate_projection</span> <span class="o">=</span> <span class="n">abstractapi</span><span class="p">()</span>

    <span class="nd">@magictoolbar</span>
    <span class="k">class</span> <span class="nc">SimulatorTools</span><span class="p">(</span><span class="n">ChildWidget</span><span class="p">):</span>
        <span class="n">add_component</span> <span class="o">=</span> <span class="n">abstractapi</span><span class="p">()</span>
        <span class="n">sep0</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">Separator</span><span class="p">)</span>
        <span class="n">generate_molecules</span> <span class="o">=</span> <span class="n">abstractapi</span><span class="p">()</span>
        <span class="n">expand</span> <span class="o">=</span> <span class="n">abstractapi</span><span class="p">()</span>
        <span class="n">twist</span> <span class="o">=</span> <span class="n">abstractapi</span><span class="p">()</span>
        <span class="n">dilate</span> <span class="o">=</span> <span class="n">abstractapi</span><span class="p">()</span>
        <span class="n">displace</span> <span class="o">=</span> <span class="n">abstractapi</span><span class="p">()</span>

    <span class="n">component_list</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">ComponentList</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;components&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_prep_radon</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">components</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">]],</span>
        <span class="n">degrees</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">],</span>
        <span class="n">order</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ip</span><span class="o">.</span><span class="n">ImgArray</span><span class="p">:</span>
        <span class="c1"># noise-free tomogram generation from the current cylinder model</span>
        <span class="n">main</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_main</span><span class="p">()</span>
        <span class="n">tomo</span> <span class="o">=</span> <span class="n">main</span><span class="o">.</span><span class="n">tomogram</span>
        <span class="n">scale</span> <span class="o">=</span> <span class="n">tomo</span><span class="o">.</span><span class="n">scale</span>
        <span class="n">shape</span> <span class="o">=</span> <span class="n">tomo</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span>
        <span class="n">simulator</span> <span class="o">=</span> <span class="n">TomogramSimulator</span><span class="p">(</span><span class="n">order</span><span class="o">=</span><span class="n">order</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">layer_name</span><span class="p">,</span> <span class="n">temp_path</span> <span class="ow">in</span> <span class="n">components</span><span class="p">:</span>
            <span class="n">mole</span> <span class="o">=</span> <span class="n">main</span><span class="o">.</span><span class="n">mole_layers</span><span class="p">[</span><span class="n">layer_name</span><span class="p">]</span><span class="o">.</span><span class="n">molecules</span>
            <span class="n">simulator</span><span class="o">.</span><span class="n">add_molecules</span><span class="p">(</span><span class="n">mole</span><span class="p">,</span> <span class="n">pipe</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="n">temp_path</span><span class="p">))</span>
        <span class="n">tilt_series</span> <span class="o">=</span> <span class="n">simulator</span><span class="o">.</span><span class="n">simulate_tilt_series</span><span class="p">(</span><span class="n">degrees</span><span class="o">=</span><span class="n">degrees</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">tilt_series</span> <span class="o">=</span> <span class="n">ip</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span>
            <span class="n">tilt_series</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;degree&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Simulated&quot;</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">tilt_series</span><span class="o">.</span><span class="n">set_scale</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">scale</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">scale</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_proper_molecules_layers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span><span class="p">):</span>
        <span class="n">out</span> <span class="o">=</span> <span class="nb">list</span><span class="p">[</span><span class="n">MoleculesLayer</span><span class="p">]()</span>
        <span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_main</span><span class="p">()</span><span class="o">.</span><span class="n">mole_layers</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">layer</span><span class="o">.</span><span class="n">source_spline</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">mole</span> <span class="o">=</span> <span class="n">layer</span><span class="o">.</span><span class="n">molecules</span>
            <span class="n">cols</span> <span class="o">=</span> <span class="n">mole</span><span class="o">.</span><span class="n">features</span><span class="o">.</span><span class="n">columns</span>
            <span class="k">if</span> <span class="n">Mole</span><span class="o">.</span><span class="n">nth</span> <span class="ow">in</span> <span class="n">cols</span> <span class="ow">and</span> <span class="n">Mole</span><span class="o">.</span><span class="n">pf</span> <span class="ow">in</span> <span class="n">cols</span> <span class="ow">and</span> <span class="n">mole</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">layer</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">out</span>

    <span class="n">_ModeledMoleculesLayer</span> <span class="o">=</span> <span class="n">Annotated</span><span class="p">[</span>
        <span class="n">MoleculesLayer</span><span class="p">,</span>
        <span class="p">{</span><span class="s2">&quot;choices&quot;</span><span class="p">:</span> <span class="n">_get_proper_molecules_layers</span><span class="p">,</span> <span class="s2">&quot;validator&quot;</span><span class="p">:</span> <span class="n">_as_layer_name</span><span class="p">},</span>
    <span class="p">]</span>

    <span class="nd">@set_design</span><span class="p">(</span><span class="n">icon</span><span class="o">=</span><span class="s2">&quot;fluent:cloud-add-16-filled&quot;</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="n">SimulatorTools</span><span class="p">)</span>
    <span class="nd">@do_not_record</span>
    <span class="k">def</span> <span class="nf">add_component</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">layer</span><span class="p">:</span> <span class="n">MoleculesLayerType</span><span class="p">,</span>
        <span class="n">template_path</span><span class="p">:</span> <span class="n">Path</span><span class="o">.</span><span class="n">Read</span><span class="p">[</span><span class="n">FileFilter</span><span class="o">.</span><span class="n">IMAGE</span><span class="p">],</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a set of template and a molecules as a simulation component.</span>

<span class="sd">        A component defines which molecules corresponds to what template image.</span>
<span class="sd">        Multiple components can be added to simulate a tomogram with different</span>
<span class="sd">        materials.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        layer : MoleculesLayer</span>
<span class="sd">            Layer to be used for simulation.</span>
<span class="sd">        template_path : Path</span>
<span class="sd">            Path to the template image that will be used to simulate the</span>
<span class="sd">            corresponding molecules layer.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">layer</span> <span class="o">=</span> <span class="n">assert_layer</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent_viewer</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">component_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Component</span><span class="p">(</span><span class="n">template_path</span><span class="p">,</span> <span class="n">layer</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">component_list</span><span class="o">.</span><span class="n">_on_children_change</span><span class="p">()</span>

    <span class="nd">@set_design</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">capitalize</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="n">CreateMenu</span><span class="p">)</span>
    <span class="nd">@thread_worker</span><span class="o">.</span><span class="n">with_progress</span><span class="p">(</span><span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Creating an image&quot;</span><span class="p">)</span>
    <span class="nd">@confirm</span><span class="p">(</span>
        <span class="n">text</span><span class="o">=</span><span class="s2">&quot;You have an opened image. Run anyway?&quot;</span><span class="p">,</span>
        <span class="n">condition</span><span class="o">=</span><span class="s2">&quot;not self._get_main().tomogram.is_dummy&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">def</span> <span class="nf">create_empty_image</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">size</span><span class="p">:</span> <span class="n">_ImageSize</span> <span class="o">=</span> <span class="p">(</span><span class="mf">60.0</span><span class="p">,</span> <span class="mf">200.0</span><span class="p">,</span> <span class="mf">60.0</span><span class="p">),</span>
        <span class="n">scale</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="n">nm</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;pixel scale (nm/pixel)&quot;</span><span class="p">}]</span> <span class="o">=</span> <span class="mf">0.25</span><span class="p">,</span>
    <span class="p">):</span>  <span class="c1"># fmt: skip</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create an empty image with the given size and scale, and send it to the viewer.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        size : (nm, nm, nm), default (60., 200., 60.)</span>
<span class="sd">            Size of the image in nm, of (Z, Y, X).</span>
<span class="sd">        scale : nm, default 0.25</span>
<span class="sd">            Pixel size of the image.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">main</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_main</span><span class="p">()</span>
        <span class="n">shape</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">roundint</span><span class="p">(</span><span class="n">s</span> <span class="o">/</span> <span class="n">scale</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">size</span><span class="p">)</span>

        <span class="n">binsize</span> <span class="o">=</span> <span class="n">ceilint</span><span class="p">(</span><span class="mf">0.96</span> <span class="o">/</span> <span class="n">scale</span><span class="p">)</span>
        <span class="c1"># NOTE: zero-filled image breaks contrast limit calculation, and bad for</span>
        <span class="c1"># visual detection of the image edges.</span>
        <span class="n">tomo</span> <span class="o">=</span> <span class="n">CylTomogram</span><span class="o">.</span><span class="n">dummy</span><span class="p">(</span><span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="p">,</span> <span class="n">binsize</span><span class="o">=</span><span class="n">binsize</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">main</span><span class="o">.</span><span class="n">_macro_offset</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">main</span><span class="o">.</span><span class="n">macro</span><span class="p">)</span>
        <span class="k">yield</span> <span class="n">main</span><span class="o">.</span><span class="n">_send_tomogram_to_viewer</span><span class="o">.</span><span class="n">with_args</span><span class="p">(</span><span class="n">tomo</span><span class="p">)</span>
        <span class="n">main</span><span class="o">.</span><span class="n">_reserved_layers</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">bounding_box</span><span class="o">.</span><span class="n">visible</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="nd">@set_design</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">capitalize</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="n">CreateMenu</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">create_straight_line</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">start</span><span class="p">:</span> <span class="n">_Point3D</span><span class="p">,</span>
        <span class="n">end</span><span class="p">:</span> <span class="n">_Point3D</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a straight line as a spline.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        start : (nm, nm, nm)</span>
<span class="sd">            Start point of the line.</span>
<span class="sd">        end : (nm, nm, nm)</span>
<span class="sd">            End point of the line.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">spl</span> <span class="o">=</span> <span class="n">CylSpline</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>
        <span class="n">main</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_main</span><span class="p">()</span>
        <span class="n">main</span><span class="o">.</span><span class="n">tomogram</span><span class="o">.</span><span class="n">splines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">spl</span><span class="p">)</span>
        <span class="n">main</span><span class="o">.</span><span class="n">_add_spline_instance</span><span class="p">(</span><span class="n">spl</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="nd">@set_design</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">capitalize</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="n">CreateMenu</span><span class="p">)</span>
    <span class="nd">@thread_worker</span><span class="o">.</span><span class="n">with_progress</span><span class="p">(</span><span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Creating an image&quot;</span><span class="p">)</span>
    <span class="nd">@confirm</span><span class="p">(</span>
        <span class="n">text</span><span class="o">=</span><span class="s2">&quot;You have an opened image. Run anyway?&quot;</span><span class="p">,</span>
        <span class="n">condition</span><span class="o">=</span><span class="s2">&quot;not self._get_main().tomogram.is_dummy&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">def</span> <span class="nf">create_image_with_straight_line</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">length</span><span class="p">:</span> <span class="n">nm</span> <span class="o">=</span> <span class="mf">150.0</span><span class="p">,</span>
        <span class="n">size</span><span class="p">:</span> <span class="n">_ImageSize</span> <span class="o">=</span> <span class="p">(</span><span class="mf">60.0</span><span class="p">,</span> <span class="mf">200.0</span><span class="p">,</span> <span class="mf">60.0</span><span class="p">),</span>
        <span class="n">scale</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="n">nm</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;pixel scale (nm/pixel)&quot;</span><span class="p">}]</span> <span class="o">=</span> <span class="mf">0.25</span><span class="p">,</span>
        <span class="n">yxrotation</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;max&quot;</span><span class="p">:</span> <span class="mi">90</span><span class="p">,</span> <span class="s2">&quot;step&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Rotation in YX plane (deg)&quot;</span><span class="p">}]</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
        <span class="n">zxrotation</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;max&quot;</span><span class="p">:</span> <span class="mi">90</span><span class="p">,</span> <span class="s2">&quot;step&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Rotation in ZX plane (deg)&quot;</span><span class="p">}]</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
    <span class="p">):</span>  <span class="c1"># fmt: skip</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a straight line as a cylinder spline.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        length : nm, default 150.0</span>
<span class="sd">            Length if the straight line in nm.</span>
<span class="sd">        size : (nm, nm, nm), (60.0, 200.0, 60.0)</span>
<span class="sd">            Size of the tomogram in which the spline will reside.</span>
<span class="sd">        scale : nm, default 0.25</span>
<span class="sd">            Scale of pixel in nm/pixel.</span>
<span class="sd">        yxrotation : float, optional</span>
<span class="sd">            Rotation in YX plane. This rotation will be applied before ZX rotation.</span>
<span class="sd">        zxrotation : float, optional</span>
<span class="sd">            Rotation in ZX plane. This rotation will be applied before YX rotation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">yxrot</span> <span class="o">=</span> <span class="n">Rotation</span><span class="o">.</span><span class="n">from_rotvec</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">yxrotation</span><span class="p">),</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">])</span>
        <span class="n">zxrot</span> <span class="o">=</span> <span class="n">Rotation</span><span class="o">.</span><span class="n">from_rotvec</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">zxrotation</span><span class="p">)])</span>
        <span class="n">start_shift</span> <span class="o">=</span> <span class="n">zxrot</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">yxrot</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="n">length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">])))</span>
        <span class="n">end_shift</span> <span class="o">=</span> <span class="n">zxrot</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">yxrot</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">])))</span>
        <span class="n">center</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">size</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="k">yield from</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_empty_image</span><span class="o">.</span><span class="n">arun</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="p">)</span>
        <span class="n">cb</span> <span class="o">=</span> <span class="n">thread_worker</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">create_straight_line</span><span class="p">)</span>
        <span class="k">yield</span> <span class="n">cb</span><span class="o">.</span><span class="n">with_args</span><span class="p">(</span><span class="n">start_shift</span> <span class="o">+</span> <span class="n">center</span><span class="p">,</span> <span class="n">end_shift</span> <span class="o">+</span> <span class="n">center</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_spline_idx</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_main</span><span class="p">()</span><span class="o">.</span><span class="n">_get_spline_idx</span><span class="p">()</span>

    <span class="nd">@set_design</span><span class="p">(</span><span class="n">icon</span><span class="o">=</span><span class="s2">&quot;fluent:select-object-skew-20-regular&quot;</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="n">SimulatorTools</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">generate_molecules</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">spline</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;bind&quot;</span><span class="p">:</span> <span class="n">_get_spline_idx</span><span class="p">}]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">spacing</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="n">nm</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;min&quot;</span><span class="p">:</span> <span class="mf">0.2</span><span class="p">,</span> <span class="s2">&quot;max&quot;</span><span class="p">:</span> <span class="mf">100.0</span><span class="p">,</span> <span class="s2">&quot;step&quot;</span><span class="p">:</span> <span class="mf">0.01</span><span class="p">,</span> <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;spacing (nm)&quot;</span><span class="p">}]</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
        <span class="n">twist</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;min&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mf">45.0</span><span class="p">,</span> <span class="s2">&quot;max&quot;</span><span class="p">:</span> <span class="mf">45.0</span><span class="p">,</span> <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;twist (deg)&quot;</span><span class="p">}]</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
        <span class="n">start</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;min&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mi">50</span><span class="p">,</span> <span class="s2">&quot;max&quot;</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span> <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;start&quot;</span><span class="p">}]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">npf</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;min&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;number of PF&quot;</span><span class="p">}]</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
        <span class="n">radius</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="n">nm</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;min&quot;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span> <span class="s2">&quot;max&quot;</span><span class="p">:</span> <span class="mf">50.0</span><span class="p">,</span> <span class="s2">&quot;step&quot;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span> <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;radius (nm)&quot;</span><span class="p">}]</span> <span class="o">=</span> <span class="mf">10.0</span><span class="p">,</span>
        <span class="n">offsets</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
        <span class="n">update_glob</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;update spline global properties&quot;</span><span class="p">}]</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">):</span>  <span class="c1"># fmt: skip</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update cylinder model with new parameters.</span>

<span class="sd">        Local structural displacement will be deleted because this function may change</span>
<span class="sd">        the number of molecules. This function should be called first.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        spacing : nm</span>
<span class="sd">            Axial spacing between molecules.</span>
<span class="sd">        twist : float</span>
<span class="sd">            Monomer twist of the cylinder.</span>
<span class="sd">        start : int</span>
<span class="sd">            The start number.</span>
<span class="sd">        npf : int</span>
<span class="sd">            Number of protofilaments.</span>
<span class="sd">        radius : nm</span>
<span class="sd">            Radius of the cylinder.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># NOTE: these parameters are hard-coded for microtubule for now.</span>
        <span class="n">main</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_main</span><span class="p">()</span>
        <span class="n">spl</span> <span class="o">=</span> <span class="n">main</span><span class="o">.</span><span class="n">splines</span><span class="p">[</span><span class="n">spline</span><span class="p">]</span>
        <span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prep_model</span><span class="p">(</span><span class="n">spl</span><span class="p">,</span> <span class="n">spacing</span><span class="p">,</span> <span class="n">twist</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">npf</span><span class="p">,</span> <span class="n">radius</span><span class="p">,</span> <span class="n">offsets</span><span class="p">)</span>
        <span class="n">mole</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">to_molecules</span><span class="p">(</span><span class="n">spl</span><span class="p">)</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">_make_simulated_mole_name</span><span class="p">(</span><span class="n">main</span><span class="o">.</span><span class="n">parent_viewer</span><span class="p">)</span>
        <span class="n">layer</span> <span class="o">=</span> <span class="n">main</span><span class="o">.</span><span class="n">add_molecules</span><span class="p">(</span><span class="n">mole</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">spl</span><span class="p">)</span>
        <span class="n">_set_simulation_model</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">update_glob</span><span class="p">:</span>
            <span class="n">cparams</span> <span class="o">=</span> <span class="n">spl</span><span class="o">.</span><span class="n">cylinder_params</span><span class="p">(</span>
                <span class="n">spacing</span><span class="o">=</span><span class="n">spacing</span><span class="p">,</span> <span class="n">twist</span><span class="o">=</span><span class="n">twist</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="p">,</span> <span class="n">npf</span><span class="o">=</span><span class="n">npf</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="n">radius</span>
            <span class="p">)</span>
            <span class="n">spl</span><span class="o">.</span><span class="n">update_glob_by_cylinder_params</span><span class="p">(</span><span class="n">cparams</span><span class="p">)</span>

    <span class="nd">@impl_preview</span><span class="p">(</span><span class="n">generate_molecules</span><span class="p">,</span> <span class="n">auto_call</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_preview_generate_molecules</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">spline</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">spacing</span><span class="p">:</span> <span class="n">nm</span><span class="p">,</span>
        <span class="n">twist</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">start</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">npf</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">radius</span><span class="p">:</span> <span class="n">nm</span><span class="p">,</span>
        <span class="n">offsets</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span>
    <span class="p">):</span>
        <span class="n">main</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_main</span><span class="p">()</span>
        <span class="n">spl</span> <span class="o">=</span> <span class="n">main</span><span class="o">.</span><span class="n">splines</span><span class="p">[</span><span class="n">spline</span><span class="p">]</span>
        <span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prep_model</span><span class="p">(</span><span class="n">spl</span><span class="p">,</span> <span class="n">spacing</span><span class="p">,</span> <span class="n">twist</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">npf</span><span class="p">,</span> <span class="n">radius</span><span class="p">,</span> <span class="n">offsets</span><span class="p">)</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">to_molecules</span><span class="p">(</span><span class="n">spl</span><span class="p">)</span>
        <span class="n">viewer</span> <span class="o">=</span> <span class="n">main</span><span class="o">.</span><span class="n">parent_viewer</span>
        <span class="k">if</span> <span class="n">PREVIEW_LAYER_NAME</span> <span class="ow">in</span> <span class="n">viewer</span><span class="o">.</span><span class="n">layers</span><span class="p">:</span>
            <span class="n">layer</span><span class="p">:</span> <span class="n">Layer</span> <span class="o">=</span> <span class="n">viewer</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="n">PREVIEW_LAYER_NAME</span><span class="p">]</span>
            <span class="n">layer</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">pos</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">layer</span> <span class="o">=</span> <span class="n">main</span><span class="o">.</span><span class="n">add_molecules</span><span class="p">(</span>
                <span class="n">out</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">PREVIEW_LAYER_NAME</span><span class="p">,</span> <span class="n">face_color</span><span class="o">=</span><span class="s2">&quot;crimson&quot;</span>
            <span class="p">)</span>
        <span class="n">is_active</span> <span class="o">=</span> <span class="k">yield</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_active</span> <span class="ow">and</span> <span class="n">layer</span> <span class="ow">in</span> <span class="n">viewer</span><span class="o">.</span><span class="n">layers</span><span class="p">:</span>
            <span class="n">viewer</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">layer</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_prep_model</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">spl</span><span class="p">:</span> <span class="n">CylSpline</span><span class="p">,</span>
        <span class="n">spacing</span><span class="p">:</span> <span class="n">nm</span><span class="p">,</span>
        <span class="n">twist</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">start</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">npf</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">radius</span><span class="p">:</span> <span class="n">nm</span><span class="p">,</span>
        <span class="n">offsets</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CylinderModel</span><span class="p">:</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">H</span><span class="o">.</span><span class="n">spacing</span><span class="p">:</span> <span class="n">spacing</span><span class="p">,</span>
            <span class="n">H</span><span class="o">.</span><span class="n">twist</span><span class="p">:</span> <span class="n">twist</span><span class="p">,</span>
            <span class="n">H</span><span class="o">.</span><span class="n">start</span><span class="p">:</span> <span class="n">start</span><span class="p">,</span>
            <span class="n">H</span><span class="o">.</span><span class="n">npf</span><span class="p">:</span> <span class="n">npf</span><span class="p">,</span>
            <span class="n">H</span><span class="o">.</span><span class="n">radius</span><span class="p">:</span> <span class="n">radius</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">spl</span><span class="o">.</span><span class="n">cylinder_model</span><span class="p">(</span><span class="n">offsets</span><span class="o">=</span><span class="n">offsets</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">model</span>

    <span class="k">def</span> <span class="nf">_get_components</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">component_list</span><span class="o">.</span><span class="n">_as_input</span><span class="p">()</span>

    <span class="nd">@set_design</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">capitalize</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="n">SimulateMenu</span><span class="p">)</span>
    <span class="nd">@dask_thread_worker</span><span class="o">.</span><span class="n">with_progress</span><span class="p">(</span><span class="n">descs</span><span class="o">=</span><span class="n">_simulate_tomogram_iter</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">simulate_tomogram</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">components</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;bind&quot;</span><span class="p">:</span> <span class="n">_get_components</span><span class="p">}],</span>
        <span class="n">save_dir</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="n">Path</span><span class="o">.</span><span class="n">Save</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Save at&quot;</span><span class="p">}],</span>
        <span class="n">nsr</span><span class="p">:</span> <span class="n">_NSRatios</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.5</span><span class="p">],</span>
        <span class="n">tilt_range</span><span class="p">:</span> <span class="n">_TiltRange</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mf">60.0</span><span class="p">,</span> <span class="mf">60.0</span><span class="p">),</span>
        <span class="n">n_tilt</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Number of tilts&quot;</span><span class="p">}]</span> <span class="o">=</span> <span class="mi">21</span><span class="p">,</span>
        <span class="n">interpolation</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;choices&quot;</span><span class="p">:</span> <span class="n">INTERPOLATION_CHOICES</span><span class="p">}]</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
        <span class="n">seed</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Annotated</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;min&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;max&quot;</span><span class="p">:</span> <span class="mf">1e8</span><span class="p">}]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>  <span class="c1"># fmt: skip</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Simulate tomographic images using the current model and save the images.</span>

<span class="sd">        This function projects the template image to each tilt series, adding</span>
<span class="sd">        Gaussian noise, and back-projects the noisy tilt series to the tomogram.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        components : list of (str, Path)</span>
<span class="sd">            List of tuples of layer name and path to the template image.</span>
<span class="sd">        save_dir : Path</span>
<span class="sd">            Path to the directory where the images will be saved.</span>
<span class="sd">        nsr : list of float</span>
<span class="sd">            Noise-to-signal ratio. It is defined by N/S, where S is the maximum</span>
<span class="sd">            value of the true monomer density and N is the standard deviation of</span>
<span class="sd">            the Gaussian noise. Duplicate values are allowed, which is useful</span>
<span class="sd">            for simulation of multiple images with the same noise level.</span>
<span class="sd">        tilt_range : tuple of float</span>
<span class="sd">            Minimum and maximum tilt angles in degree.</span>
<span class="sd">        n_tilt : int</span>
<span class="sd">            Number of tilt angles between minimum and maximum angles.</span>
<span class="sd">        interpolation : int</span>
<span class="sd">            Interpolation method used during the simulation.</span>
<span class="sd">        seed : int, optional</span>
<span class="sd">            Random seed used for the Gaussian noise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">save_dir</span> <span class="o">=</span> <span class="n">_norm_save_dir</span><span class="p">(</span><span class="n">save_dir</span><span class="p">)</span>
        <span class="n">_assert_not_empty</span><span class="p">(</span><span class="n">components</span><span class="p">)</span>
        <span class="n">nsr</span> <span class="o">=</span> <span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">_nsr</span><span class="p">),</span> <span class="mi">4</span><span class="p">)</span> <span class="k">for</span> <span class="n">_nsr</span> <span class="ow">in</span> <span class="n">nsr</span><span class="p">]</span>
        <span class="n">main</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_main</span><span class="p">()</span>
        <span class="n">degrees</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">*</span><span class="n">tilt_range</span><span class="p">,</span> <span class="n">n_tilt</span><span class="p">)</span>
        <span class="n">sino</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prep_radon</span><span class="p">(</span><span class="n">components</span><span class="p">,</span> <span class="n">degrees</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="n">interpolation</span><span class="p">)</span>

        <span class="k">yield</span> <span class="n">_on_radon_finished</span><span class="o">.</span><span class="n">with_args</span><span class="p">(</span><span class="n">sino</span><span class="p">,</span> <span class="n">degrees</span><span class="p">)</span>

        <span class="n">rng</span> <span class="o">=</span> <span class="n">ip</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
        <span class="n">imax</span> <span class="o">=</span> <span class="n">sino</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">nsr_val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">nsr</span><span class="p">):</span>
            <span class="n">sino_noise</span> <span class="o">=</span> <span class="n">sino</span> <span class="o">+</span> <span class="n">rng</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span>
                <span class="n">scale</span><span class="o">=</span><span class="n">imax</span> <span class="o">*</span> <span class="n">nsr_val</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">sino</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="n">sino</span><span class="o">.</span><span class="n">axes</span>
            <span class="p">)</span>
            <span class="n">rec</span> <span class="o">=</span> <span class="n">sino_noise</span><span class="o">.</span><span class="n">iradon</span><span class="p">(</span>
                <span class="n">degrees</span><span class="p">,</span>
                <span class="n">central_axis</span><span class="o">=</span><span class="s2">&quot;y&quot;</span><span class="p">,</span>
                <span class="n">height</span><span class="o">=</span><span class="n">main</span><span class="o">.</span><span class="n">tomogram</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                <span class="n">order</span><span class="o">=</span><span class="n">interpolation</span><span class="p">,</span>
            <span class="p">)</span><span class="o">.</span><span class="n">set_scale</span><span class="p">(</span><span class="n">zyx</span><span class="o">=</span><span class="n">main</span><span class="o">.</span><span class="n">tomogram</span><span class="o">.</span><span class="n">scale</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;nm&quot;</span><span class="p">)</span>
            <span class="k">yield</span> <span class="n">_on_iradon_finished</span><span class="o">.</span><span class="n">with_args</span><span class="p">(</span><span class="n">rec</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;N/S = </span><span class="si">{</span><span class="n">nsr_val</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="n">file_name</span> <span class="o">=</span> <span class="n">save_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;image-</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">.mrc&quot;</span>
            <span class="n">rec</span><span class="o">.</span><span class="n">imsave</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>
            <span class="n">_Logger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Image saved at </span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>

        <span class="n">main</span><span class="o">.</span><span class="n">save_project</span><span class="p">(</span><span class="n">save_dir</span> <span class="o">/</span> <span class="n">PROJECT_NAME</span><span class="p">,</span> <span class="n">molecules_ext</span><span class="o">=</span><span class="s2">&quot;.parquet&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="nd">@set_design</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">capitalize</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="n">SimulateMenu</span><span class="p">)</span>
    <span class="nd">@dask_thread_worker</span><span class="o">.</span><span class="n">with_progress</span><span class="p">(</span><span class="n">descs</span><span class="o">=</span><span class="n">_simulate_tomogram_from_tilt_iter</span><span class="p">)</span>
    <span class="nd">@confirm</span><span class="p">(</span>
        <span class="n">text</span><span class="o">=</span><span class="s2">&quot;You have an opened image. Run anyway?&quot;</span><span class="p">,</span>
        <span class="n">condition</span><span class="o">=</span><span class="s2">&quot;not self._get_main().tomogram.is_dummy&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">def</span> <span class="nf">simulate_tomogram_from_tilt_series</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">path</span><span class="p">:</span> <span class="n">Path</span><span class="o">.</span><span class="n">Read</span><span class="p">[</span><span class="n">FileFilter</span><span class="o">.</span><span class="n">IMAGE</span><span class="p">],</span>
        <span class="n">nsr</span><span class="p">:</span> <span class="n">_NSRatio</span> <span class="o">=</span> <span class="mf">1.5</span><span class="p">,</span>
        <span class="n">bin_size</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="p">{</span><span class="s2">&quot;options&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;min&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;max&quot;</span><span class="p">:</span> <span class="mi">32</span><span class="p">}}]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span>
        <span class="n">tilt_range</span><span class="p">:</span> <span class="n">_TiltRange</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mf">60.0</span><span class="p">,</span> <span class="mf">60.0</span><span class="p">),</span>
        <span class="n">height</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="n">nm</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;height (nm)&quot;</span><span class="p">}]</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
        <span class="n">interpolation</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;choices&quot;</span><span class="p">:</span> <span class="n">INTERPOLATION_CHOICES</span><span class="p">}]</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
        <span class="n">seed</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Annotated</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;min&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;max&quot;</span><span class="p">:</span> <span class="mf">1e8</span><span class="p">}]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Simulate tomographic images using a tilt series.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        path : Path</span>
<span class="sd">            Path to the tilt series image.</span>
<span class="sd">        nsr : float</span>
<span class="sd">            Noise-to-signal ratio. It is defined by N/S, where S is the maximum</span>
<span class="sd">            value of the tilt series. If the input image is already noisy, you</span>
<span class="sd">            can set this value to zero to avoid adding more noises.</span>
<span class="sd">        bin_size : list of int</span>
<span class="sd">            Bin sizes used to create multi-scaled images from the simulated image.</span>
<span class="sd">        tilt_range : tuple of float</span>
<span class="sd">            Minimum and maximum tilt angles in degree.</span>
<span class="sd">        height : int</span>
<span class="sd">            Height of the simulated tomogram in nm.</span>
<span class="sd">        interpolation : int</span>
<span class="sd">            Interpolation method used during the simulation.</span>
<span class="sd">        seed : int, optional</span>
<span class="sd">            Random seed used for the Gaussian noise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">main</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_main</span><span class="p">()</span>
        <span class="n">sino</span> <span class="o">=</span> <span class="n">ip</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="n">scale</span> <span class="o">=</span> <span class="n">sino</span><span class="o">.</span><span class="n">scale</span><span class="o">.</span><span class="n">x</span>
        <span class="k">if</span> <span class="n">sino</span><span class="o">.</span><span class="n">ndim</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Input image must be a 3D image.&quot;</span><span class="p">)</span>
        <span class="n">degrees</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">*</span><span class="n">tilt_range</span><span class="p">,</span> <span class="n">sino</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">rng</span> <span class="o">=</span> <span class="n">ip</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
        <span class="n">imax</span> <span class="o">=</span> <span class="n">sino</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="n">sino_noise</span> <span class="o">=</span> <span class="n">sino</span> <span class="o">+</span> <span class="n">rng</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span>
            <span class="n">scale</span><span class="o">=</span><span class="n">imax</span> <span class="o">*</span> <span class="n">nsr</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">sino</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="n">sino</span><span class="o">.</span><span class="n">axes</span>
        <span class="p">)</span>
        <span class="k">yield</span> <span class="n">thread_worker</span><span class="o">.</span><span class="n">callback</span><span class="p">()</span>
        <span class="n">rec</span> <span class="o">=</span> <span class="n">sino_noise</span><span class="o">.</span><span class="n">iradon</span><span class="p">(</span>
            <span class="n">degrees</span><span class="p">,</span>
            <span class="n">central_axis</span><span class="o">=</span><span class="s2">&quot;y&quot;</span><span class="p">,</span>
            <span class="n">height</span><span class="o">=</span><span class="n">roundint</span><span class="p">(</span><span class="n">height</span> <span class="o">/</span> <span class="n">scale</span><span class="p">),</span>
            <span class="n">order</span><span class="o">=</span><span class="n">interpolation</span><span class="p">,</span>
        <span class="p">)</span><span class="o">.</span><span class="n">set_scale</span><span class="p">(</span><span class="n">zyx</span><span class="o">=</span><span class="n">scale</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;nm&quot;</span><span class="p">)</span>
        <span class="k">yield</span> <span class="n">_on_iradon_finished</span><span class="o">.</span><span class="n">with_args</span><span class="p">(</span><span class="n">rec</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;N/S = </span><span class="si">{</span><span class="n">nsr</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">rec</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">SIMULATED_IMAGE_NAME</span>
        <span class="n">tomo</span> <span class="o">=</span> <span class="n">CylTomogram</span><span class="o">.</span><span class="n">from_image</span><span class="p">(</span>
            <span class="n">rec</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="p">,</span> <span class="n">tilt</span><span class="o">=</span><span class="n">tilt_range</span><span class="p">,</span> <span class="n">binsize</span><span class="o">=</span><span class="n">bin_size</span>
        <span class="p">)</span>
        <span class="n">main</span><span class="o">.</span><span class="n">_macro_offset</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">main</span><span class="o">.</span><span class="n">macro</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">main</span><span class="o">.</span><span class="n">_send_tomogram_to_viewer</span><span class="o">.</span><span class="n">with_args</span><span class="p">(</span><span class="n">tomo</span><span class="p">)</span>

    <span class="nd">@set_design</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">capitalize</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="n">SimulateMenu</span><span class="p">)</span>
    <span class="nd">@dask_thread_worker</span><span class="o">.</span><span class="n">with_progress</span><span class="p">(</span><span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Simulating tomogram...&quot;</span><span class="p">)</span>
    <span class="nd">@confirm</span><span class="p">(</span>
        <span class="n">text</span><span class="o">=</span><span class="s2">&quot;You have an opened image. Run anyway?&quot;</span><span class="p">,</span>
        <span class="n">condition</span><span class="o">=</span><span class="s2">&quot;not self._get_main().tomogram.is_dummy&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">def</span> <span class="nf">simulate_tomogram_and_open</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">components</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;bind&quot;</span><span class="p">:</span> <span class="n">_get_components</span><span class="p">}],</span>
        <span class="n">nsr</span><span class="p">:</span> <span class="n">_NSRatio</span> <span class="o">=</span> <span class="mf">1.5</span><span class="p">,</span>
        <span class="n">bin_size</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="p">{</span><span class="s2">&quot;options&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;min&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;max&quot;</span><span class="p">:</span> <span class="mi">32</span><span class="p">}}]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span>
        <span class="n">tilt_range</span><span class="p">:</span> <span class="n">_TiltRange</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mf">60.0</span><span class="p">,</span> <span class="mf">60.0</span><span class="p">),</span>
        <span class="n">n_tilt</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Number of tilts&quot;</span><span class="p">}]</span> <span class="o">=</span> <span class="mi">21</span><span class="p">,</span>
        <span class="n">interpolation</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;choices&quot;</span><span class="p">:</span> <span class="n">INTERPOLATION_CHOICES</span><span class="p">}]</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
        <span class="n">seed</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Annotated</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;min&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;max&quot;</span><span class="p">:</span> <span class="mf">1e8</span><span class="p">}]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>  <span class="c1"># fmt: skip</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Simulate a tomogram and open the image immediately.</span>

<span class="sd">        This function projects the template image to each tilt series, adding</span>
<span class="sd">        Gaussian noise, and back-projects the noisy tilt series to the tomogram.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        components : list of (str, Path)</span>
<span class="sd">            List of tuples of layer name and path to the template image.</span>
<span class="sd">        nsr : list of float</span>
<span class="sd">            Noise-to-signal ratio. It is defined by N/S, where S is the maximum</span>
<span class="sd">            value of the true monomer density and N is the standard deviation of</span>
<span class="sd">            the Gaussian noise.</span>
<span class="sd">        bin_size : list of int</span>
<span class="sd">            Bin sizes used to create multi-scaled images from the simulated image.</span>
<span class="sd">        tilt_range : tuple of float</span>
<span class="sd">            Minimum and maximum tilt angles in degree.</span>
<span class="sd">        n_tilt : int</span>
<span class="sd">            Number of tilt angles between minimum and maximum angles.</span>
<span class="sd">        interpolation : int</span>
<span class="sd">            Interpolation method used during the simulation.</span>
<span class="sd">        seed : int, optional</span>
<span class="sd">            Random seed used for the Gaussian noise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">nsr</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">nsr</span><span class="p">),</span> <span class="mi">4</span><span class="p">)</span>
        <span class="n">_assert_not_empty</span><span class="p">(</span><span class="n">components</span><span class="p">)</span>
        <span class="n">main</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_main</span><span class="p">()</span>
        <span class="n">degrees</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">*</span><span class="n">tilt_range</span><span class="p">,</span> <span class="n">n_tilt</span><span class="p">)</span>
        <span class="n">mole_layers</span> <span class="o">=</span> <span class="p">[</span><span class="n">main</span><span class="o">.</span><span class="n">mole_layers</span><span class="p">[</span><span class="n">layer_name</span><span class="p">]</span> <span class="k">for</span> <span class="n">layer_name</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">components</span><span class="p">]</span>
        <span class="n">sources</span> <span class="o">=</span> <span class="p">[</span><span class="n">layer</span><span class="o">.</span><span class="n">source_spline</span> <span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="n">mole_layers</span><span class="p">]</span>
        <span class="n">sino</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prep_radon</span><span class="p">(</span><span class="n">components</span><span class="p">,</span> <span class="n">degrees</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="n">interpolation</span><span class="p">)</span>

        <span class="k">yield</span> <span class="n">_on_radon_finished</span><span class="o">.</span><span class="n">with_args</span><span class="p">(</span><span class="n">sino</span><span class="p">,</span> <span class="n">degrees</span><span class="p">)</span>

        <span class="n">rng</span> <span class="o">=</span> <span class="n">ip</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
        <span class="n">imax</span> <span class="o">=</span> <span class="n">sino</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="n">sino_noise</span> <span class="o">=</span> <span class="n">sino</span> <span class="o">+</span> <span class="n">rng</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span>
            <span class="n">scale</span><span class="o">=</span><span class="n">imax</span> <span class="o">*</span> <span class="n">nsr</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">sino</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="n">sino</span><span class="o">.</span><span class="n">axes</span>
        <span class="p">)</span>
        <span class="n">rec</span> <span class="o">=</span> <span class="n">sino_noise</span><span class="o">.</span><span class="n">iradon</span><span class="p">(</span>
            <span class="n">degrees</span><span class="p">,</span>
            <span class="n">central_axis</span><span class="o">=</span><span class="s2">&quot;y&quot;</span><span class="p">,</span>
            <span class="n">height</span><span class="o">=</span><span class="n">main</span><span class="o">.</span><span class="n">tomogram</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="n">order</span><span class="o">=</span><span class="n">interpolation</span><span class="p">,</span>
        <span class="p">)</span><span class="o">.</span><span class="n">set_scale</span><span class="p">(</span><span class="n">zyx</span><span class="o">=</span><span class="n">sino</span><span class="o">.</span><span class="n">scale</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;nm&quot;</span><span class="p">)</span>
        <span class="k">yield</span> <span class="n">_on_iradon_finished</span><span class="o">.</span><span class="n">with_args</span><span class="p">(</span><span class="n">rec</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;N/S = </span><span class="si">{</span><span class="n">nsr</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">rec</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">SIMULATED_IMAGE_NAME</span>
        <span class="n">tomo</span> <span class="o">=</span> <span class="n">CylTomogram</span><span class="o">.</span><span class="n">from_image</span><span class="p">(</span>
            <span class="n">rec</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">sino</span><span class="o">.</span><span class="n">scale</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">tilt</span><span class="o">=</span><span class="n">tilt_range</span><span class="p">,</span> <span class="n">binsize</span><span class="o">=</span><span class="n">bin_size</span>
        <span class="p">)</span>
        <span class="n">tomo</span><span class="o">.</span><span class="n">splines</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">sources</span><span class="p">)</span>
        <span class="k">yield</span> <span class="n">main</span><span class="o">.</span><span class="n">_send_tomogram_to_viewer</span><span class="o">.</span><span class="n">with_args</span><span class="p">(</span><span class="n">tomo</span><span class="p">)</span>

        <span class="nd">@thread_worker</span><span class="o">.</span><span class="n">callback</span>
        <span class="k">def</span> <span class="nf">_on_return</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">layer</span><span class="p">,</span> <span class="n">source_spline</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">mole_layers</span><span class="p">,</span> <span class="n">sources</span><span class="p">,</span> <span class="n">strict</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
                <span class="n">main</span><span class="o">.</span><span class="n">parent_viewer</span><span class="o">.</span><span class="n">add_layer</span><span class="p">(</span><span class="n">layer</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">source_spline</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">layer</span><span class="o">.</span><span class="n">source_component</span> <span class="o">=</span> <span class="n">source_spline</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">main</span><span class="o">.</span><span class="n">splines</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">main</span><span class="o">.</span><span class="n">_update_splines_in_images</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">_on_return</span>

    <span class="nd">@set_design</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">capitalize</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="n">SimulateMenu</span><span class="p">)</span>
    <span class="nd">@dask_thread_worker</span><span class="o">.</span><span class="n">with_progress</span><span class="p">(</span><span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Simulating tilt series...&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">simulate_tilt_series</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">components</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;bind&quot;</span><span class="p">:</span> <span class="n">_get_components</span><span class="p">}],</span>
        <span class="n">save_dir</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="n">Path</span><span class="o">.</span><span class="n">Save</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Save at&quot;</span><span class="p">}],</span>
        <span class="n">tilt_range</span><span class="p">:</span> <span class="n">_TiltRange</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mf">60.0</span><span class="p">,</span> <span class="mf">60.0</span><span class="p">),</span>
        <span class="n">n_tilt</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Number of tilts&quot;</span><span class="p">}]</span> <span class="o">=</span> <span class="mi">21</span><span class="p">,</span>
        <span class="n">interpolation</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;choices&quot;</span><span class="p">:</span> <span class="n">INTERPOLATION_CHOICES</span><span class="p">}]</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
    <span class="p">):</span>  <span class="c1"># fmt: skip</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Simulate tilt series using the current model and save the images.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        components : list of (str, Path)</span>
<span class="sd">            List of tuples of layer name and path to the template image.</span>
<span class="sd">        save_dir : Path</span>
<span class="sd">            Directory path where the tilt series will be saved.</span>
<span class="sd">        tilt_range : tuple of float</span>
<span class="sd">            Minimum and maximum tilt angles in degree.</span>
<span class="sd">        n_tilt : int</span>
<span class="sd">            Number of tilt angles between minimum and maximum angles.</span>
<span class="sd">        interpolation : int</span>
<span class="sd">            Interpolation method used during the simulation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">save_dir</span> <span class="o">=</span> <span class="n">_norm_save_dir</span><span class="p">(</span><span class="n">save_dir</span><span class="p">)</span>
        <span class="n">_assert_not_empty</span><span class="p">(</span><span class="n">components</span><span class="p">)</span>
        <span class="n">degrees</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">*</span><span class="n">tilt_range</span><span class="p">,</span> <span class="n">n_tilt</span><span class="p">)</span>
        <span class="n">sino</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prep_radon</span><span class="p">(</span><span class="n">components</span><span class="p">,</span> <span class="n">degrees</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="n">interpolation</span><span class="p">)</span>
        <span class="n">scale</span> <span class="o">=</span> <span class="n">sino</span><span class="o">.</span><span class="n">scale</span><span class="o">.</span><span class="n">x</span>
        <span class="n">save_path</span> <span class="o">=</span> <span class="n">save_dir</span> <span class="o">/</span> <span class="s2">&quot;image.mrc&quot;</span>
        <span class="n">sino</span><span class="o">.</span><span class="n">set_axes</span><span class="p">(</span><span class="s2">&quot;zyx&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">set_scale</span><span class="p">(</span><span class="n">zyx</span><span class="o">=</span><span class="n">scale</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;nm&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">imsave</span><span class="p">(</span><span class="n">save_path</span><span class="p">)</span>
        <span class="n">_Logger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Tilt series saved at </span><span class="si">{</span><span class="n">save_path</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_get_main</span><span class="p">()</span><span class="o">.</span><span class="n">save_project</span><span class="p">(</span><span class="n">save_dir</span> <span class="o">/</span> <span class="n">PROJECT_NAME</span><span class="p">,</span> <span class="n">molecules_ext</span><span class="o">=</span><span class="s2">&quot;.parquet&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="nd">@set_design</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">capitalize</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="n">SimulateMenu</span><span class="p">)</span>
    <span class="nd">@dask_thread_worker</span><span class="o">.</span><span class="n">with_progress</span><span class="p">(</span><span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Simulating 2D projections...&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">simulate_projection</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">components</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;bind&quot;</span><span class="p">:</span> <span class="n">_get_components</span><span class="p">}],</span>
        <span class="n">save_dir</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="n">Path</span><span class="o">.</span><span class="n">Save</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Save at&quot;</span><span class="p">}],</span>
        <span class="n">nsr</span><span class="p">:</span> <span class="n">_NSRatios</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.5</span><span class="p">],</span>
        <span class="n">interpolation</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;choices&quot;</span><span class="p">:</span> <span class="n">INTERPOLATION_CHOICES</span><span class="p">}]</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
        <span class="n">seed</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Annotated</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;min&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;max&quot;</span><span class="p">:</span> <span class="mf">1e8</span><span class="p">}]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>  <span class="c1"># fmt: skip</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Simulate a projection without tilt (cryo-EM-like image).</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        components : list of (str, Path)</span>
<span class="sd">            List of tuples of layer name and path to the template image.</span>
<span class="sd">        save_dir : Path</span>
<span class="sd">            Path to the directory where the images will be saved.</span>
<span class="sd">        nsr : list of float</span>
<span class="sd">            Noise-to-signal ratio. It is defined by N/S, where S is the maximum</span>
<span class="sd">            value of the true monomer density and N is the standard deviation of</span>
<span class="sd">            the Gaussian noise. Duplicate values are allowed, which is useful</span>
<span class="sd">            for simulation of multiple images with the same noise level.</span>
<span class="sd">        interpolation : int</span>
<span class="sd">            Interpolation method used during the simulation.</span>
<span class="sd">        seed : int, optional</span>
<span class="sd">            Random seed used for the Gaussian noise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">save_dir</span> <span class="o">=</span> <span class="n">_norm_save_dir</span><span class="p">(</span><span class="n">save_dir</span><span class="p">)</span>
        <span class="n">_assert_not_empty</span><span class="p">(</span><span class="n">components</span><span class="p">)</span>
        <span class="n">proj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prep_radon</span><span class="p">(</span><span class="n">components</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">order</span><span class="o">=</span><span class="n">interpolation</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">proj</span> <span class="o">=</span> <span class="n">proj</span><span class="o">.</span><span class="n">set_axes</span><span class="p">(</span><span class="s2">&quot;yx&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">set_scale</span><span class="p">(</span><span class="n">yx</span><span class="o">=</span><span class="n">proj</span><span class="o">.</span><span class="n">scale</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;nm&quot;</span><span class="p">)</span>
        <span class="k">yield</span> <span class="n">_on_iradon_finished</span><span class="o">.</span><span class="n">with_args</span><span class="p">(</span><span class="n">proj</span><span class="p">,</span> <span class="s2">&quot;Projection (noise-free)&quot;</span><span class="p">)</span>
        <span class="n">rng</span> <span class="o">=</span> <span class="n">ip</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
        <span class="n">imax</span> <span class="o">=</span> <span class="n">proj</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">nsr_val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">nsr</span><span class="p">):</span>
            <span class="n">proj_noise</span> <span class="o">=</span> <span class="n">proj</span> <span class="o">+</span> <span class="n">rng</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span>
                <span class="n">scale</span><span class="o">=</span><span class="n">imax</span> <span class="o">*</span> <span class="n">nsr_val</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">proj</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="n">proj</span><span class="o">.</span><span class="n">axes</span>
            <span class="p">)</span>
            <span class="n">proj_noise</span><span class="o">.</span><span class="n">imsave</span><span class="p">(</span><span class="n">save_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;image-</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">.tif&quot;</span><span class="p">)</span>
        <span class="n">_Logger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Projections saved at </span><span class="si">{</span><span class="n">save_dir</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_get_main</span><span class="p">()</span><span class="o">.</span><span class="n">save_project</span><span class="p">(</span><span class="n">save_dir</span> <span class="o">/</span> <span class="n">PROJECT_NAME</span><span class="p">,</span> <span class="n">molecules_ext</span><span class="o">=</span><span class="s2">&quot;.parquet&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="nd">@set_design</span><span class="p">(</span><span class="n">icon</span><span class="o">=</span><span class="s2">&quot;iconoir:expand-lines&quot;</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="n">SimulatorTools</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">expand</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">layer</span><span class="p">:</span> <span class="n">_ModeledMoleculesLayer</span><span class="p">,</span>
        <span class="n">by</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;min&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="s2">&quot;max&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">}]</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
        <span class="n">yrange</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="p">{</span><span class="s2">&quot;widget_type&quot;</span><span class="p">:</span> <span class="n">RangeSlider</span><span class="p">}]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
        <span class="n">arange</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="p">{</span><span class="s2">&quot;widget_type&quot;</span><span class="p">:</span> <span class="n">RangeSlider</span><span class="p">}]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
        <span class="n">allev</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Apply local expansion to molecules.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        layer : MoleculesLayer</span>
<span class="sd">            Layer to be transformed.</span>
<span class="sd">        by : float</span>
<span class="sd">            Amount of expansion in nm.</span>
<span class="sd">        yrange : tuple of int</span>
<span class="sd">            Range of Y axis to be transformed. Range is [a, b).</span>
<span class="sd">        arange : tuple of int</span>
<span class="sd">            Range of angle axis to be transformed. Range is [a, b).</span>
<span class="sd">        allev : bool</span>
<span class="sd">            Alleviation of the local expansion. If true, the surrounding molecules</span>
<span class="sd">            will be shifted to alleviate the local expansion.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">layer</span> <span class="o">=</span> <span class="n">assert_layer</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent_viewer</span><span class="p">)</span>
        <span class="n">spl</span><span class="p">,</span> <span class="n">model</span> <span class="o">=</span> <span class="n">_local_transform</span><span class="p">(</span>
            <span class="n">CylinderModel</span><span class="o">.</span><span class="n">expand</span><span class="p">,</span> <span class="n">layer</span><span class="p">,</span> <span class="n">by</span><span class="p">,</span> <span class="n">yrange</span><span class="p">,</span> <span class="n">arange</span><span class="p">,</span> <span class="n">allev</span>
        <span class="p">)</span>
        <span class="n">layer</span><span class="o">.</span><span class="n">molecules</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">to_molecules</span><span class="p">(</span><span class="n">spl</span><span class="p">,</span> <span class="n">layer</span><span class="o">.</span><span class="n">molecules</span><span class="o">.</span><span class="n">features</span><span class="p">)</span>
        <span class="n">_set_simulation_model</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="nd">@set_design</span><span class="p">(</span><span class="n">icon</span><span class="o">=</span><span class="s2">&quot;mingcute:rotate-x-line&quot;</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="n">SimulatorTools</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">twist</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">layer</span><span class="p">:</span> <span class="n">_ModeledMoleculesLayer</span><span class="p">,</span>
        <span class="n">by</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;min&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="s2">&quot;max&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">}]</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
        <span class="n">yrange</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="p">{</span><span class="s2">&quot;widget_type&quot;</span><span class="p">:</span> <span class="n">RangeSlider</span><span class="p">}]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
        <span class="n">arange</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="p">{</span><span class="s2">&quot;widget_type&quot;</span><span class="p">:</span> <span class="n">RangeSlider</span><span class="p">}]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
        <span class="n">allev</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Apply local twist to molecules.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        layer : MoleculesLayer</span>
<span class="sd">            Layer to be transformed.</span>
<span class="sd">        by : float</span>
<span class="sd">            Amount of twist in degree.</span>
<span class="sd">        yrange : tuple of int</span>
<span class="sd">            Range of Y axis to be transformed. Range is [a, b).</span>
<span class="sd">        arange : tuple of int</span>
<span class="sd">            Range of angle axis to be transformed. Range is [a, b).</span>
<span class="sd">        allev : bool</span>
<span class="sd">            Alleviation of the local expansion. If true, the surrounding molecules</span>
<span class="sd">            will be shifted to alleviate the local expansion.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">layer</span> <span class="o">=</span> <span class="n">assert_layer</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent_viewer</span><span class="p">)</span>
        <span class="n">spl</span><span class="p">,</span> <span class="n">model</span> <span class="o">=</span> <span class="n">_local_transform</span><span class="p">(</span>
            <span class="n">CylinderModel</span><span class="o">.</span><span class="n">twist</span><span class="p">,</span> <span class="n">layer</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">by</span><span class="p">),</span> <span class="n">yrange</span><span class="p">,</span> <span class="n">arange</span><span class="p">,</span> <span class="n">allev</span>
        <span class="p">)</span>
        <span class="n">layer</span><span class="o">.</span><span class="n">molecules</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">to_molecules</span><span class="p">(</span><span class="n">spl</span><span class="p">,</span> <span class="n">layer</span><span class="o">.</span><span class="n">molecules</span><span class="o">.</span><span class="n">features</span><span class="p">)</span>
        <span class="n">_set_simulation_model</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="nd">@set_design</span><span class="p">(</span><span class="n">icon</span><span class="o">=</span><span class="s2">&quot;iconoir:scale-frame-enlarge&quot;</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="n">SimulatorTools</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">dilate</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">layer</span><span class="p">:</span> <span class="n">_ModeledMoleculesLayer</span><span class="p">,</span>
        <span class="n">by</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;min&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="s2">&quot;max&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">}]</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
        <span class="n">yrange</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="p">{</span><span class="s2">&quot;widget_type&quot;</span><span class="p">:</span> <span class="n">RangeSlider</span><span class="p">}]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
        <span class="n">arange</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="p">{</span><span class="s2">&quot;widget_type&quot;</span><span class="p">:</span> <span class="n">RangeSlider</span><span class="p">}]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
        <span class="n">allev</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Apply local dilation to molecules.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        layer : MoleculesLayer</span>
<span class="sd">            Layer to be transformed.</span>
<span class="sd">        by : float</span>
<span class="sd">            Amount of dilation in nm.</span>
<span class="sd">        yrange : tuple of int</span>
<span class="sd">            Range of Y axis to be transformed. Range is [a, b).</span>
<span class="sd">        arange : tuple of int</span>
<span class="sd">            Range of angle axis to be transformed. Range is [a, b).</span>
<span class="sd">        allev : bool</span>
<span class="sd">            Alleviation of the local expansion. If true, the surrounding molecules</span>
<span class="sd">            will be shifted to alleviate the local expansion.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">layer</span> <span class="o">=</span> <span class="n">assert_layer</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent_viewer</span><span class="p">)</span>
        <span class="n">spl</span><span class="p">,</span> <span class="n">model</span> <span class="o">=</span> <span class="n">_local_transform</span><span class="p">(</span>
            <span class="n">CylinderModel</span><span class="o">.</span><span class="n">dilate</span><span class="p">,</span> <span class="n">layer</span><span class="p">,</span> <span class="n">by</span><span class="p">,</span> <span class="n">yrange</span><span class="p">,</span> <span class="n">arange</span><span class="p">,</span> <span class="n">allev</span>
        <span class="p">)</span>
        <span class="n">layer</span><span class="o">.</span><span class="n">molecules</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">to_molecules</span><span class="p">(</span><span class="n">spl</span><span class="p">,</span> <span class="n">layer</span><span class="o">.</span><span class="n">molecules</span><span class="o">.</span><span class="n">features</span><span class="p">)</span>
        <span class="n">_set_simulation_model</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="nd">@set_design</span><span class="p">(</span><span class="n">icon</span><span class="o">=</span><span class="s2">&quot;fluent:arrow-move-20-filled&quot;</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="n">SimulatorTools</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">displace</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">layer</span><span class="p">:</span> <span class="n">_ModeledMoleculesLayer</span><span class="p">,</span>
        <span class="n">expand</span><span class="p">:</span> <span class="n">ExprStr</span><span class="o">.</span><span class="n">In</span><span class="p">[</span><span class="n">POLARS_NAMESPACE</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
        <span class="n">twist</span><span class="p">:</span> <span class="n">ExprStr</span><span class="o">.</span><span class="n">In</span><span class="p">[</span><span class="n">POLARS_NAMESPACE</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
        <span class="n">dilate</span><span class="p">:</span> <span class="n">ExprStr</span><span class="o">.</span><span class="n">In</span><span class="p">[</span><span class="n">POLARS_NAMESPACE</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Detailed local transformation of molecules.</span>

<span class="sd">        In this method, you&#39;ll have to specify the displacement for each molecule</span>
<span class="sd">        using polars expressions. For example, if you want to expand the molecules</span>
<span class="sd">        with odd numbering by 0.1 nm, you can set `expand` to</span>
<span class="sd">        &gt;&gt;&gt; pl.when(pl.col(&quot;nth&quot;) % 2 == 0).then(0).otherwise(0.1)</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        layer : ModelLayer</span>
<span class="sd">            Layer to be transformed.</span>
<span class="sd">        expand : str, pl.Expr or constant</span>
<span class="sd">            Displacement in the longitudinal direction (nm).</span>
<span class="sd">        twist : str, pl.Expr or constant</span>
<span class="sd">            Displacement in the angular direction (degree).</span>
<span class="sd">        dilate : str, pl.Expr or constant</span>
<span class="sd">            Displacement from the center (nm).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">layer</span> <span class="o">=</span> <span class="n">assert_layer</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent_viewer</span><span class="p">)</span>
        <span class="n">new_model</span> <span class="o">=</span> <span class="n">_get_shifted_model</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="n">expand</span><span class="p">,</span> <span class="n">twist</span><span class="p">,</span> <span class="n">dilate</span><span class="p">)</span>
        <span class="n">layer</span><span class="o">.</span><span class="n">molecules</span> <span class="o">=</span> <span class="n">new_model</span><span class="o">.</span><span class="n">to_molecules</span><span class="p">(</span>
            <span class="n">layer</span><span class="o">.</span><span class="n">source_spline</span><span class="p">,</span> <span class="n">layer</span><span class="o">.</span><span class="n">molecules</span><span class="o">.</span><span class="n">features</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">_set_simulation_model</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="n">new_model</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="cylindra.widgets.subwidgets.Simulator.add_component" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">add_component</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="n">template_path</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Add a set of template and a molecules as a simulation component.</p>
<p>A component defines which molecules corresponds to what template image.
Multiple components can be added to simulate a tomogram with different
materials.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>layer</code></td>
            <td>
                  <code><span title="cylindra._napari.MoleculesLayer">MoleculesLayer</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Layer to be used for simulation.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>template_path</code></td>
            <td>
                  <code><span title="magicclass.types.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the template image that will be used to simulate the
corresponding molecules layer.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>cylindra/widgets/subwidgets/simulator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@set_design</span><span class="p">(</span><span class="n">icon</span><span class="o">=</span><span class="s2">&quot;fluent:cloud-add-16-filled&quot;</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="n">SimulatorTools</span><span class="p">)</span>
<span class="nd">@do_not_record</span>
<span class="k">def</span> <span class="nf">add_component</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">layer</span><span class="p">:</span> <span class="n">MoleculesLayerType</span><span class="p">,</span>
    <span class="n">template_path</span><span class="p">:</span> <span class="n">Path</span><span class="o">.</span><span class="n">Read</span><span class="p">[</span><span class="n">FileFilter</span><span class="o">.</span><span class="n">IMAGE</span><span class="p">],</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Add a set of template and a molecules as a simulation component.</span>

<span class="sd">    A component defines which molecules corresponds to what template image.</span>
<span class="sd">    Multiple components can be added to simulate a tomogram with different</span>
<span class="sd">    materials.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    layer : MoleculesLayer</span>
<span class="sd">        Layer to be used for simulation.</span>
<span class="sd">    template_path : Path</span>
<span class="sd">        Path to the template image that will be used to simulate the</span>
<span class="sd">        corresponding molecules layer.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">layer</span> <span class="o">=</span> <span class="n">assert_layer</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent_viewer</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">component_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Component</span><span class="p">(</span><span class="n">template_path</span><span class="p">,</span> <span class="n">layer</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">component_list</span><span class="o">.</span><span class="n">_on_children_change</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="cylindra.widgets.subwidgets.Simulator.create_empty_image" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">create_empty_image</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mf">60.0</span><span class="p">,</span> <span class="mf">200.0</span><span class="p">,</span> <span class="mf">60.0</span><span class="p">),</span> <span class="n">scale</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Create an empty image with the given size and scale, and send it to the viewer.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>size</code></td>
            <td>
                  <code>(<span title="cylindra.const.nm">nm</span>, <span title="cylindra.const.nm">nm</span>, <span title="cylindra.const.nm">nm</span>)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Size of the image in nm, of (Z, Y, X).</p>
              </div>
            </td>
            <td>
                  <code>(60., 200., 60.)</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>scale</code></td>
            <td>
                  <code><span title="cylindra.const.nm">nm</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Pixel size of the image.</p>
              </div>
            </td>
            <td>
                  <code>0.25</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>cylindra/widgets/subwidgets/simulator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@set_design</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">capitalize</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="n">CreateMenu</span><span class="p">)</span>
<span class="nd">@thread_worker</span><span class="o">.</span><span class="n">with_progress</span><span class="p">(</span><span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Creating an image&quot;</span><span class="p">)</span>
<span class="nd">@confirm</span><span class="p">(</span>
    <span class="n">text</span><span class="o">=</span><span class="s2">&quot;You have an opened image. Run anyway?&quot;</span><span class="p">,</span>
    <span class="n">condition</span><span class="o">=</span><span class="s2">&quot;not self._get_main().tomogram.is_dummy&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="k">def</span> <span class="nf">create_empty_image</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">size</span><span class="p">:</span> <span class="n">_ImageSize</span> <span class="o">=</span> <span class="p">(</span><span class="mf">60.0</span><span class="p">,</span> <span class="mf">200.0</span><span class="p">,</span> <span class="mf">60.0</span><span class="p">),</span>
    <span class="n">scale</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="n">nm</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;pixel scale (nm/pixel)&quot;</span><span class="p">}]</span> <span class="o">=</span> <span class="mf">0.25</span><span class="p">,</span>
<span class="p">):</span>  <span class="c1"># fmt: skip</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create an empty image with the given size and scale, and send it to the viewer.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    size : (nm, nm, nm), default (60., 200., 60.)</span>
<span class="sd">        Size of the image in nm, of (Z, Y, X).</span>
<span class="sd">    scale : nm, default 0.25</span>
<span class="sd">        Pixel size of the image.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">main</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_main</span><span class="p">()</span>
    <span class="n">shape</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">roundint</span><span class="p">(</span><span class="n">s</span> <span class="o">/</span> <span class="n">scale</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">size</span><span class="p">)</span>

    <span class="n">binsize</span> <span class="o">=</span> <span class="n">ceilint</span><span class="p">(</span><span class="mf">0.96</span> <span class="o">/</span> <span class="n">scale</span><span class="p">)</span>
    <span class="c1"># NOTE: zero-filled image breaks contrast limit calculation, and bad for</span>
    <span class="c1"># visual detection of the image edges.</span>
    <span class="n">tomo</span> <span class="o">=</span> <span class="n">CylTomogram</span><span class="o">.</span><span class="n">dummy</span><span class="p">(</span><span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="p">,</span> <span class="n">binsize</span><span class="o">=</span><span class="n">binsize</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">shape</span><span class="p">)</span>
    <span class="n">main</span><span class="o">.</span><span class="n">_macro_offset</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">main</span><span class="o">.</span><span class="n">macro</span><span class="p">)</span>
    <span class="k">yield</span> <span class="n">main</span><span class="o">.</span><span class="n">_send_tomogram_to_viewer</span><span class="o">.</span><span class="n">with_args</span><span class="p">(</span><span class="n">tomo</span><span class="p">)</span>
    <span class="n">main</span><span class="o">.</span><span class="n">_reserved_layers</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">bounding_box</span><span class="o">.</span><span class="n">visible</span> <span class="o">=</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="cylindra.widgets.subwidgets.Simulator.create_image_with_straight_line" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">create_image_with_straight_line</span><span class="p">(</span><span class="n">length</span><span class="o">=</span><span class="mf">150.0</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mf">60.0</span><span class="p">,</span> <span class="mf">200.0</span><span class="p">,</span> <span class="mf">60.0</span><span class="p">),</span> <span class="n">scale</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">yxrotation</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">zxrotation</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Create a straight line as a cylinder spline.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>length</code></td>
            <td>
                  <code><span title="cylindra.const.nm">nm</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Length if the straight line in nm.</p>
              </div>
            </td>
            <td>
                  <code>150.0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>size</code></td>
            <td>
                  <code>((<span title="cylindra.const.nm">nm</span>, <span title="cylindra.const.nm">nm</span>, <span title="cylindra.const.nm">nm</span>), (60.0, 200.0, 60.0))</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Size of the tomogram in which the spline will reside.</p>
              </div>
            </td>
            <td>
                  <code>(60.0, 200.0, 60.0)</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>scale</code></td>
            <td>
                  <code><span title="cylindra.const.nm">nm</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Scale of pixel in nm/pixel.</p>
              </div>
            </td>
            <td>
                  <code>0.25</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>yxrotation</code></td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#float">float</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Rotation in YX plane. This rotation will be applied before ZX rotation.</p>
              </div>
            </td>
            <td>
                  <code>0.0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>zxrotation</code></td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#float">float</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Rotation in ZX plane. This rotation will be applied before YX rotation.</p>
              </div>
            </td>
            <td>
                  <code>0.0</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>cylindra/widgets/subwidgets/simulator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@set_design</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">capitalize</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="n">CreateMenu</span><span class="p">)</span>
<span class="nd">@thread_worker</span><span class="o">.</span><span class="n">with_progress</span><span class="p">(</span><span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Creating an image&quot;</span><span class="p">)</span>
<span class="nd">@confirm</span><span class="p">(</span>
    <span class="n">text</span><span class="o">=</span><span class="s2">&quot;You have an opened image. Run anyway?&quot;</span><span class="p">,</span>
    <span class="n">condition</span><span class="o">=</span><span class="s2">&quot;not self._get_main().tomogram.is_dummy&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="k">def</span> <span class="nf">create_image_with_straight_line</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">length</span><span class="p">:</span> <span class="n">nm</span> <span class="o">=</span> <span class="mf">150.0</span><span class="p">,</span>
    <span class="n">size</span><span class="p">:</span> <span class="n">_ImageSize</span> <span class="o">=</span> <span class="p">(</span><span class="mf">60.0</span><span class="p">,</span> <span class="mf">200.0</span><span class="p">,</span> <span class="mf">60.0</span><span class="p">),</span>
    <span class="n">scale</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="n">nm</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;pixel scale (nm/pixel)&quot;</span><span class="p">}]</span> <span class="o">=</span> <span class="mf">0.25</span><span class="p">,</span>
    <span class="n">yxrotation</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;max&quot;</span><span class="p">:</span> <span class="mi">90</span><span class="p">,</span> <span class="s2">&quot;step&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Rotation in YX plane (deg)&quot;</span><span class="p">}]</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
    <span class="n">zxrotation</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;max&quot;</span><span class="p">:</span> <span class="mi">90</span><span class="p">,</span> <span class="s2">&quot;step&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Rotation in ZX plane (deg)&quot;</span><span class="p">}]</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
<span class="p">):</span>  <span class="c1"># fmt: skip</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a straight line as a cylinder spline.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    length : nm, default 150.0</span>
<span class="sd">        Length if the straight line in nm.</span>
<span class="sd">    size : (nm, nm, nm), (60.0, 200.0, 60.0)</span>
<span class="sd">        Size of the tomogram in which the spline will reside.</span>
<span class="sd">    scale : nm, default 0.25</span>
<span class="sd">        Scale of pixel in nm/pixel.</span>
<span class="sd">    yxrotation : float, optional</span>
<span class="sd">        Rotation in YX plane. This rotation will be applied before ZX rotation.</span>
<span class="sd">    zxrotation : float, optional</span>
<span class="sd">        Rotation in ZX plane. This rotation will be applied before YX rotation.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">yxrot</span> <span class="o">=</span> <span class="n">Rotation</span><span class="o">.</span><span class="n">from_rotvec</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">yxrotation</span><span class="p">),</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">])</span>
    <span class="n">zxrot</span> <span class="o">=</span> <span class="n">Rotation</span><span class="o">.</span><span class="n">from_rotvec</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">zxrotation</span><span class="p">)])</span>
    <span class="n">start_shift</span> <span class="o">=</span> <span class="n">zxrot</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">yxrot</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="n">length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">])))</span>
    <span class="n">end_shift</span> <span class="o">=</span> <span class="n">zxrot</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">yxrot</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">])))</span>
    <span class="n">center</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">size</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="k">yield from</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_empty_image</span><span class="o">.</span><span class="n">arun</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="p">)</span>
    <span class="n">cb</span> <span class="o">=</span> <span class="n">thread_worker</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">create_straight_line</span><span class="p">)</span>
    <span class="k">yield</span> <span class="n">cb</span><span class="o">.</span><span class="n">with_args</span><span class="p">(</span><span class="n">start_shift</span> <span class="o">+</span> <span class="n">center</span><span class="p">,</span> <span class="n">end_shift</span> <span class="o">+</span> <span class="n">center</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="cylindra.widgets.subwidgets.Simulator.create_straight_line" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">create_straight_line</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Create a straight line as a spline.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>start</code></td>
            <td>
                  <code>(<span title="cylindra.const.nm">nm</span>, <span title="cylindra.const.nm">nm</span>, <span title="cylindra.const.nm">nm</span>)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Start point of the line.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>end</code></td>
            <td>
                  <code>(<span title="cylindra.const.nm">nm</span>, <span title="cylindra.const.nm">nm</span>, <span title="cylindra.const.nm">nm</span>)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>End point of the line.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>cylindra/widgets/subwidgets/simulator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@set_design</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">capitalize</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="n">CreateMenu</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">create_straight_line</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">start</span><span class="p">:</span> <span class="n">_Point3D</span><span class="p">,</span>
    <span class="n">end</span><span class="p">:</span> <span class="n">_Point3D</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a straight line as a spline.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    start : (nm, nm, nm)</span>
<span class="sd">        Start point of the line.</span>
<span class="sd">    end : (nm, nm, nm)</span>
<span class="sd">        End point of the line.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">spl</span> <span class="o">=</span> <span class="n">CylSpline</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>
    <span class="n">main</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_main</span><span class="p">()</span>
    <span class="n">main</span><span class="o">.</span><span class="n">tomogram</span><span class="o">.</span><span class="n">splines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">spl</span><span class="p">)</span>
    <span class="n">main</span><span class="o">.</span><span class="n">_add_spline_instance</span><span class="p">(</span><span class="n">spl</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="cylindra.widgets.subwidgets.Simulator.dilate" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">dilate</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="n">by</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">yrange</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">arange</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">allev</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Apply local dilation to molecules.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>layer</code></td>
            <td>
                  <code><span title="cylindra._napari.MoleculesLayer">MoleculesLayer</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Layer to be transformed.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>by</code></td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#float">float</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Amount of dilation in nm.</p>
              </div>
            </td>
            <td>
                  <code>0.0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>yrange</code></td>
            <td>
                  <code>tuple of int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Range of Y axis to be transformed. Range is [a, b).</p>
              </div>
            </td>
            <td>
                  <code>(0, 1)</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>arange</code></td>
            <td>
                  <code>tuple of int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Range of angle axis to be transformed. Range is [a, b).</p>
              </div>
            </td>
            <td>
                  <code>(0, 1)</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>allev</code></td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Alleviation of the local expansion. If true, the surrounding molecules
will be shifted to alleviate the local expansion.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>cylindra/widgets/subwidgets/simulator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@set_design</span><span class="p">(</span><span class="n">icon</span><span class="o">=</span><span class="s2">&quot;iconoir:scale-frame-enlarge&quot;</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="n">SimulatorTools</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">dilate</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">layer</span><span class="p">:</span> <span class="n">_ModeledMoleculesLayer</span><span class="p">,</span>
    <span class="n">by</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;min&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="s2">&quot;max&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">}]</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
    <span class="n">yrange</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="p">{</span><span class="s2">&quot;widget_type&quot;</span><span class="p">:</span> <span class="n">RangeSlider</span><span class="p">}]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
    <span class="n">arange</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="p">{</span><span class="s2">&quot;widget_type&quot;</span><span class="p">:</span> <span class="n">RangeSlider</span><span class="p">}]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
    <span class="n">allev</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Apply local dilation to molecules.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    layer : MoleculesLayer</span>
<span class="sd">        Layer to be transformed.</span>
<span class="sd">    by : float</span>
<span class="sd">        Amount of dilation in nm.</span>
<span class="sd">    yrange : tuple of int</span>
<span class="sd">        Range of Y axis to be transformed. Range is [a, b).</span>
<span class="sd">    arange : tuple of int</span>
<span class="sd">        Range of angle axis to be transformed. Range is [a, b).</span>
<span class="sd">    allev : bool</span>
<span class="sd">        Alleviation of the local expansion. If true, the surrounding molecules</span>
<span class="sd">        will be shifted to alleviate the local expansion.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">layer</span> <span class="o">=</span> <span class="n">assert_layer</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent_viewer</span><span class="p">)</span>
    <span class="n">spl</span><span class="p">,</span> <span class="n">model</span> <span class="o">=</span> <span class="n">_local_transform</span><span class="p">(</span>
        <span class="n">CylinderModel</span><span class="o">.</span><span class="n">dilate</span><span class="p">,</span> <span class="n">layer</span><span class="p">,</span> <span class="n">by</span><span class="p">,</span> <span class="n">yrange</span><span class="p">,</span> <span class="n">arange</span><span class="p">,</span> <span class="n">allev</span>
    <span class="p">)</span>
    <span class="n">layer</span><span class="o">.</span><span class="n">molecules</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">to_molecules</span><span class="p">(</span><span class="n">spl</span><span class="p">,</span> <span class="n">layer</span><span class="o">.</span><span class="n">molecules</span><span class="o">.</span><span class="n">features</span><span class="p">)</span>
    <span class="n">_set_simulation_model</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="cylindra.widgets.subwidgets.Simulator.displace" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">displace</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="n">expand</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">twist</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">dilate</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Detailed local transformation of molecules.</p>
<p>In this method, you'll have to specify the displacement for each molecule
using polars expressions. For example, if you want to expand the molecules
with odd numbering by 0.1 nm, you can set <code>expand</code> to</p>
<blockquote>
<blockquote>
<blockquote>
<p>pl.when(pl.col("nth") % 2 == 0).then(0).otherwise(0.1)</p>
</blockquote>
</blockquote>
</blockquote>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>layer</code></td>
            <td>
                  <code>ModelLayer</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Layer to be transformed.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>expand</code></td>
            <td>
                  <code>(<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <span title="polars.Expr">Expr</span> or constant)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Displacement in the longitudinal direction (nm).</p>
              </div>
            </td>
            <td>
                  <code>0.0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>twist</code></td>
            <td>
                  <code>(<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <span title="polars.Expr">Expr</span> or constant)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Displacement in the angular direction (degree).</p>
              </div>
            </td>
            <td>
                  <code>0.0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>dilate</code></td>
            <td>
                  <code>(<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <span title="polars.Expr">Expr</span> or constant)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Displacement from the center (nm).</p>
              </div>
            </td>
            <td>
                  <code>0.0</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>cylindra/widgets/subwidgets/simulator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span>
<span class="normal">865</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@set_design</span><span class="p">(</span><span class="n">icon</span><span class="o">=</span><span class="s2">&quot;fluent:arrow-move-20-filled&quot;</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="n">SimulatorTools</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">displace</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">layer</span><span class="p">:</span> <span class="n">_ModeledMoleculesLayer</span><span class="p">,</span>
    <span class="n">expand</span><span class="p">:</span> <span class="n">ExprStr</span><span class="o">.</span><span class="n">In</span><span class="p">[</span><span class="n">POLARS_NAMESPACE</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
    <span class="n">twist</span><span class="p">:</span> <span class="n">ExprStr</span><span class="o">.</span><span class="n">In</span><span class="p">[</span><span class="n">POLARS_NAMESPACE</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
    <span class="n">dilate</span><span class="p">:</span> <span class="n">ExprStr</span><span class="o">.</span><span class="n">In</span><span class="p">[</span><span class="n">POLARS_NAMESPACE</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Detailed local transformation of molecules.</span>

<span class="sd">    In this method, you&#39;ll have to specify the displacement for each molecule</span>
<span class="sd">    using polars expressions. For example, if you want to expand the molecules</span>
<span class="sd">    with odd numbering by 0.1 nm, you can set `expand` to</span>
<span class="sd">    &gt;&gt;&gt; pl.when(pl.col(&quot;nth&quot;) % 2 == 0).then(0).otherwise(0.1)</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    layer : ModelLayer</span>
<span class="sd">        Layer to be transformed.</span>
<span class="sd">    expand : str, pl.Expr or constant</span>
<span class="sd">        Displacement in the longitudinal direction (nm).</span>
<span class="sd">    twist : str, pl.Expr or constant</span>
<span class="sd">        Displacement in the angular direction (degree).</span>
<span class="sd">    dilate : str, pl.Expr or constant</span>
<span class="sd">        Displacement from the center (nm).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">layer</span> <span class="o">=</span> <span class="n">assert_layer</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent_viewer</span><span class="p">)</span>
    <span class="n">new_model</span> <span class="o">=</span> <span class="n">_get_shifted_model</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="n">expand</span><span class="p">,</span> <span class="n">twist</span><span class="p">,</span> <span class="n">dilate</span><span class="p">)</span>
    <span class="n">layer</span><span class="o">.</span><span class="n">molecules</span> <span class="o">=</span> <span class="n">new_model</span><span class="o">.</span><span class="n">to_molecules</span><span class="p">(</span>
        <span class="n">layer</span><span class="o">.</span><span class="n">source_spline</span><span class="p">,</span> <span class="n">layer</span><span class="o">.</span><span class="n">molecules</span><span class="o">.</span><span class="n">features</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">_set_simulation_model</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="n">new_model</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="cylindra.widgets.subwidgets.Simulator.expand" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">expand</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="n">by</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">yrange</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">arange</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">allev</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Apply local expansion to molecules.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>layer</code></td>
            <td>
                  <code><span title="cylindra._napari.MoleculesLayer">MoleculesLayer</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Layer to be transformed.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>by</code></td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#float">float</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Amount of expansion in nm.</p>
              </div>
            </td>
            <td>
                  <code>0.0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>yrange</code></td>
            <td>
                  <code>tuple of int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Range of Y axis to be transformed. Range is [a, b).</p>
              </div>
            </td>
            <td>
                  <code>(0, 1)</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>arange</code></td>
            <td>
                  <code>tuple of int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Range of angle axis to be transformed. Range is [a, b).</p>
              </div>
            </td>
            <td>
                  <code>(0, 1)</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>allev</code></td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Alleviation of the local expansion. If true, the surrounding molecules
will be shifted to alleviate the local expansion.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>cylindra/widgets/subwidgets/simulator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@set_design</span><span class="p">(</span><span class="n">icon</span><span class="o">=</span><span class="s2">&quot;iconoir:expand-lines&quot;</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="n">SimulatorTools</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">expand</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">layer</span><span class="p">:</span> <span class="n">_ModeledMoleculesLayer</span><span class="p">,</span>
    <span class="n">by</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;min&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="s2">&quot;max&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">}]</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
    <span class="n">yrange</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="p">{</span><span class="s2">&quot;widget_type&quot;</span><span class="p">:</span> <span class="n">RangeSlider</span><span class="p">}]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
    <span class="n">arange</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="p">{</span><span class="s2">&quot;widget_type&quot;</span><span class="p">:</span> <span class="n">RangeSlider</span><span class="p">}]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
    <span class="n">allev</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Apply local expansion to molecules.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    layer : MoleculesLayer</span>
<span class="sd">        Layer to be transformed.</span>
<span class="sd">    by : float</span>
<span class="sd">        Amount of expansion in nm.</span>
<span class="sd">    yrange : tuple of int</span>
<span class="sd">        Range of Y axis to be transformed. Range is [a, b).</span>
<span class="sd">    arange : tuple of int</span>
<span class="sd">        Range of angle axis to be transformed. Range is [a, b).</span>
<span class="sd">    allev : bool</span>
<span class="sd">        Alleviation of the local expansion. If true, the surrounding molecules</span>
<span class="sd">        will be shifted to alleviate the local expansion.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">layer</span> <span class="o">=</span> <span class="n">assert_layer</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent_viewer</span><span class="p">)</span>
    <span class="n">spl</span><span class="p">,</span> <span class="n">model</span> <span class="o">=</span> <span class="n">_local_transform</span><span class="p">(</span>
        <span class="n">CylinderModel</span><span class="o">.</span><span class="n">expand</span><span class="p">,</span> <span class="n">layer</span><span class="p">,</span> <span class="n">by</span><span class="p">,</span> <span class="n">yrange</span><span class="p">,</span> <span class="n">arange</span><span class="p">,</span> <span class="n">allev</span>
    <span class="p">)</span>
    <span class="n">layer</span><span class="o">.</span><span class="n">molecules</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">to_molecules</span><span class="p">(</span><span class="n">spl</span><span class="p">,</span> <span class="n">layer</span><span class="o">.</span><span class="n">molecules</span><span class="o">.</span><span class="n">features</span><span class="p">)</span>
    <span class="n">_set_simulation_model</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="cylindra.widgets.subwidgets.Simulator.generate_molecules" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">generate_molecules</span><span class="p">(</span><span class="n">spline</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">spacing</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">twist</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">npf</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span> <span class="n">offsets</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span> <span class="n">update_glob</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Update cylinder model with new parameters.</p>
<p>Local structural displacement will be deleted because this function may change
the number of molecules. This function should be called first.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>spacing</code></td>
            <td>
                  <code><span title="cylindra.const.nm">nm</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Axial spacing between molecules.</p>
              </div>
            </td>
            <td>
                  <code>1.0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>twist</code></td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#float">float</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Monomer twist of the cylinder.</p>
              </div>
            </td>
            <td>
                  <code>0.0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>start</code></td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The start number.</p>
              </div>
            </td>
            <td>
                  <code>0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>npf</code></td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of protofilaments.</p>
              </div>
            </td>
            <td>
                  <code>2</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>radius</code></td>
            <td>
                  <code><span title="cylindra.const.nm">nm</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Radius of the cylinder.</p>
              </div>
            </td>
            <td>
                  <code>10.0</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>cylindra/widgets/subwidgets/simulator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@set_design</span><span class="p">(</span><span class="n">icon</span><span class="o">=</span><span class="s2">&quot;fluent:select-object-skew-20-regular&quot;</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="n">SimulatorTools</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">generate_molecules</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">spline</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;bind&quot;</span><span class="p">:</span> <span class="n">_get_spline_idx</span><span class="p">}]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">spacing</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="n">nm</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;min&quot;</span><span class="p">:</span> <span class="mf">0.2</span><span class="p">,</span> <span class="s2">&quot;max&quot;</span><span class="p">:</span> <span class="mf">100.0</span><span class="p">,</span> <span class="s2">&quot;step&quot;</span><span class="p">:</span> <span class="mf">0.01</span><span class="p">,</span> <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;spacing (nm)&quot;</span><span class="p">}]</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
    <span class="n">twist</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;min&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mf">45.0</span><span class="p">,</span> <span class="s2">&quot;max&quot;</span><span class="p">:</span> <span class="mf">45.0</span><span class="p">,</span> <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;twist (deg)&quot;</span><span class="p">}]</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
    <span class="n">start</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;min&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mi">50</span><span class="p">,</span> <span class="s2">&quot;max&quot;</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span> <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;start&quot;</span><span class="p">}]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">npf</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;min&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;number of PF&quot;</span><span class="p">}]</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
    <span class="n">radius</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="n">nm</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;min&quot;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span> <span class="s2">&quot;max&quot;</span><span class="p">:</span> <span class="mf">50.0</span><span class="p">,</span> <span class="s2">&quot;step&quot;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span> <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;radius (nm)&quot;</span><span class="p">}]</span> <span class="o">=</span> <span class="mf">10.0</span><span class="p">,</span>
    <span class="n">offsets</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
    <span class="n">update_glob</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;update spline global properties&quot;</span><span class="p">}]</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">):</span>  <span class="c1"># fmt: skip</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Update cylinder model with new parameters.</span>

<span class="sd">    Local structural displacement will be deleted because this function may change</span>
<span class="sd">    the number of molecules. This function should be called first.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    spacing : nm</span>
<span class="sd">        Axial spacing between molecules.</span>
<span class="sd">    twist : float</span>
<span class="sd">        Monomer twist of the cylinder.</span>
<span class="sd">    start : int</span>
<span class="sd">        The start number.</span>
<span class="sd">    npf : int</span>
<span class="sd">        Number of protofilaments.</span>
<span class="sd">    radius : nm</span>
<span class="sd">        Radius of the cylinder.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># NOTE: these parameters are hard-coded for microtubule for now.</span>
    <span class="n">main</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_main</span><span class="p">()</span>
    <span class="n">spl</span> <span class="o">=</span> <span class="n">main</span><span class="o">.</span><span class="n">splines</span><span class="p">[</span><span class="n">spline</span><span class="p">]</span>
    <span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prep_model</span><span class="p">(</span><span class="n">spl</span><span class="p">,</span> <span class="n">spacing</span><span class="p">,</span> <span class="n">twist</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">npf</span><span class="p">,</span> <span class="n">radius</span><span class="p">,</span> <span class="n">offsets</span><span class="p">)</span>
    <span class="n">mole</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">to_molecules</span><span class="p">(</span><span class="n">spl</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">_make_simulated_mole_name</span><span class="p">(</span><span class="n">main</span><span class="o">.</span><span class="n">parent_viewer</span><span class="p">)</span>
    <span class="n">layer</span> <span class="o">=</span> <span class="n">main</span><span class="o">.</span><span class="n">add_molecules</span><span class="p">(</span><span class="n">mole</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">spl</span><span class="p">)</span>
    <span class="n">_set_simulation_model</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">update_glob</span><span class="p">:</span>
        <span class="n">cparams</span> <span class="o">=</span> <span class="n">spl</span><span class="o">.</span><span class="n">cylinder_params</span><span class="p">(</span>
            <span class="n">spacing</span><span class="o">=</span><span class="n">spacing</span><span class="p">,</span> <span class="n">twist</span><span class="o">=</span><span class="n">twist</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="p">,</span> <span class="n">npf</span><span class="o">=</span><span class="n">npf</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="n">radius</span>
        <span class="p">)</span>
        <span class="n">spl</span><span class="o">.</span><span class="n">update_glob_by_cylinder_params</span><span class="p">(</span><span class="n">cparams</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="cylindra.widgets.subwidgets.Simulator.simulate_projection" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">simulate_projection</span><span class="p">(</span><span class="n">components</span><span class="p">,</span> <span class="n">save_dir</span><span class="p">,</span> <span class="n">nsr</span><span class="o">=</span><span class="p">[</span><span class="mf">1.5</span><span class="p">],</span> <span class="n">interpolation</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Simulate a projection without tilt (cryo-EM-like image).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>components</code></td>
            <td>
                  <code>list of (str, Path)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of tuples of layer name and path to the template image.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>save_dir</code></td>
            <td>
                  <code><span title="magicclass.types.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the directory where the images will be saved.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>nsr</code></td>
            <td>
                  <code>list of float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Noise-to-signal ratio. It is defined by N/S, where S is the maximum
value of the true monomer density and N is the standard deviation of
the Gaussian noise. Duplicate values are allowed, which is useful
for simulation of multiple images with the same noise level.</p>
              </div>
            </td>
            <td>
                  <code>[1.5]</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>interpolation</code></td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Interpolation method used during the simulation.</p>
              </div>
            </td>
            <td>
                  <code>3</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>seed</code></td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Random seed used for the Gaussian noise.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>cylindra/widgets/subwidgets/simulator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@set_design</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">capitalize</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="n">SimulateMenu</span><span class="p">)</span>
<span class="nd">@dask_thread_worker</span><span class="o">.</span><span class="n">with_progress</span><span class="p">(</span><span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Simulating 2D projections...&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">simulate_projection</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">components</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;bind&quot;</span><span class="p">:</span> <span class="n">_get_components</span><span class="p">}],</span>
    <span class="n">save_dir</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="n">Path</span><span class="o">.</span><span class="n">Save</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Save at&quot;</span><span class="p">}],</span>
    <span class="n">nsr</span><span class="p">:</span> <span class="n">_NSRatios</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.5</span><span class="p">],</span>
    <span class="n">interpolation</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;choices&quot;</span><span class="p">:</span> <span class="n">INTERPOLATION_CHOICES</span><span class="p">}]</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
    <span class="n">seed</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Annotated</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;min&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;max&quot;</span><span class="p">:</span> <span class="mf">1e8</span><span class="p">}]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>  <span class="c1"># fmt: skip</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Simulate a projection without tilt (cryo-EM-like image).</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    components : list of (str, Path)</span>
<span class="sd">        List of tuples of layer name and path to the template image.</span>
<span class="sd">    save_dir : Path</span>
<span class="sd">        Path to the directory where the images will be saved.</span>
<span class="sd">    nsr : list of float</span>
<span class="sd">        Noise-to-signal ratio. It is defined by N/S, where S is the maximum</span>
<span class="sd">        value of the true monomer density and N is the standard deviation of</span>
<span class="sd">        the Gaussian noise. Duplicate values are allowed, which is useful</span>
<span class="sd">        for simulation of multiple images with the same noise level.</span>
<span class="sd">    interpolation : int</span>
<span class="sd">        Interpolation method used during the simulation.</span>
<span class="sd">    seed : int, optional</span>
<span class="sd">        Random seed used for the Gaussian noise.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">save_dir</span> <span class="o">=</span> <span class="n">_norm_save_dir</span><span class="p">(</span><span class="n">save_dir</span><span class="p">)</span>
    <span class="n">_assert_not_empty</span><span class="p">(</span><span class="n">components</span><span class="p">)</span>
    <span class="n">proj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prep_radon</span><span class="p">(</span><span class="n">components</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">order</span><span class="o">=</span><span class="n">interpolation</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">proj</span> <span class="o">=</span> <span class="n">proj</span><span class="o">.</span><span class="n">set_axes</span><span class="p">(</span><span class="s2">&quot;yx&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">set_scale</span><span class="p">(</span><span class="n">yx</span><span class="o">=</span><span class="n">proj</span><span class="o">.</span><span class="n">scale</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;nm&quot;</span><span class="p">)</span>
    <span class="k">yield</span> <span class="n">_on_iradon_finished</span><span class="o">.</span><span class="n">with_args</span><span class="p">(</span><span class="n">proj</span><span class="p">,</span> <span class="s2">&quot;Projection (noise-free)&quot;</span><span class="p">)</span>
    <span class="n">rng</span> <span class="o">=</span> <span class="n">ip</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
    <span class="n">imax</span> <span class="o">=</span> <span class="n">proj</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">nsr_val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">nsr</span><span class="p">):</span>
        <span class="n">proj_noise</span> <span class="o">=</span> <span class="n">proj</span> <span class="o">+</span> <span class="n">rng</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span>
            <span class="n">scale</span><span class="o">=</span><span class="n">imax</span> <span class="o">*</span> <span class="n">nsr_val</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">proj</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="n">proj</span><span class="o">.</span><span class="n">axes</span>
        <span class="p">)</span>
        <span class="n">proj_noise</span><span class="o">.</span><span class="n">imsave</span><span class="p">(</span><span class="n">save_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;image-</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">.tif&quot;</span><span class="p">)</span>
    <span class="n">_Logger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Projections saved at </span><span class="si">{</span><span class="n">save_dir</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_get_main</span><span class="p">()</span><span class="o">.</span><span class="n">save_project</span><span class="p">(</span><span class="n">save_dir</span> <span class="o">/</span> <span class="n">PROJECT_NAME</span><span class="p">,</span> <span class="n">molecules_ext</span><span class="o">=</span><span class="s2">&quot;.parquet&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="cylindra.widgets.subwidgets.Simulator.simulate_tilt_series" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">simulate_tilt_series</span><span class="p">(</span><span class="n">components</span><span class="p">,</span> <span class="n">save_dir</span><span class="p">,</span> <span class="n">tilt_range</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">60.0</span><span class="p">,</span> <span class="mf">60.0</span><span class="p">),</span> <span class="n">n_tilt</span><span class="o">=</span><span class="mi">21</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Simulate tilt series using the current model and save the images.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>components</code></td>
            <td>
                  <code>list of (str, Path)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of tuples of layer name and path to the template image.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>save_dir</code></td>
            <td>
                  <code><span title="magicclass.types.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Directory path where the tilt series will be saved.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>tilt_range</code></td>
            <td>
                  <code>tuple of float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Minimum and maximum tilt angles in degree.</p>
              </div>
            </td>
            <td>
                  <code>(-60.0, 60.0)</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>n_tilt</code></td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of tilt angles between minimum and maximum angles.</p>
              </div>
            </td>
            <td>
                  <code>21</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>interpolation</code></td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Interpolation method used during the simulation.</p>
              </div>
            </td>
            <td>
                  <code>3</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>cylindra/widgets/subwidgets/simulator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@set_design</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">capitalize</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="n">SimulateMenu</span><span class="p">)</span>
<span class="nd">@dask_thread_worker</span><span class="o">.</span><span class="n">with_progress</span><span class="p">(</span><span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Simulating tilt series...&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">simulate_tilt_series</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">components</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;bind&quot;</span><span class="p">:</span> <span class="n">_get_components</span><span class="p">}],</span>
    <span class="n">save_dir</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="n">Path</span><span class="o">.</span><span class="n">Save</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Save at&quot;</span><span class="p">}],</span>
    <span class="n">tilt_range</span><span class="p">:</span> <span class="n">_TiltRange</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mf">60.0</span><span class="p">,</span> <span class="mf">60.0</span><span class="p">),</span>
    <span class="n">n_tilt</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Number of tilts&quot;</span><span class="p">}]</span> <span class="o">=</span> <span class="mi">21</span><span class="p">,</span>
    <span class="n">interpolation</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;choices&quot;</span><span class="p">:</span> <span class="n">INTERPOLATION_CHOICES</span><span class="p">}]</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
<span class="p">):</span>  <span class="c1"># fmt: skip</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Simulate tilt series using the current model and save the images.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    components : list of (str, Path)</span>
<span class="sd">        List of tuples of layer name and path to the template image.</span>
<span class="sd">    save_dir : Path</span>
<span class="sd">        Directory path where the tilt series will be saved.</span>
<span class="sd">    tilt_range : tuple of float</span>
<span class="sd">        Minimum and maximum tilt angles in degree.</span>
<span class="sd">    n_tilt : int</span>
<span class="sd">        Number of tilt angles between minimum and maximum angles.</span>
<span class="sd">    interpolation : int</span>
<span class="sd">        Interpolation method used during the simulation.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">save_dir</span> <span class="o">=</span> <span class="n">_norm_save_dir</span><span class="p">(</span><span class="n">save_dir</span><span class="p">)</span>
    <span class="n">_assert_not_empty</span><span class="p">(</span><span class="n">components</span><span class="p">)</span>
    <span class="n">degrees</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">*</span><span class="n">tilt_range</span><span class="p">,</span> <span class="n">n_tilt</span><span class="p">)</span>
    <span class="n">sino</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prep_radon</span><span class="p">(</span><span class="n">components</span><span class="p">,</span> <span class="n">degrees</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="n">interpolation</span><span class="p">)</span>
    <span class="n">scale</span> <span class="o">=</span> <span class="n">sino</span><span class="o">.</span><span class="n">scale</span><span class="o">.</span><span class="n">x</span>
    <span class="n">save_path</span> <span class="o">=</span> <span class="n">save_dir</span> <span class="o">/</span> <span class="s2">&quot;image.mrc&quot;</span>
    <span class="n">sino</span><span class="o">.</span><span class="n">set_axes</span><span class="p">(</span><span class="s2">&quot;zyx&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">set_scale</span><span class="p">(</span><span class="n">zyx</span><span class="o">=</span><span class="n">scale</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;nm&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">imsave</span><span class="p">(</span><span class="n">save_path</span><span class="p">)</span>
    <span class="n">_Logger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Tilt series saved at </span><span class="si">{</span><span class="n">save_path</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_get_main</span><span class="p">()</span><span class="o">.</span><span class="n">save_project</span><span class="p">(</span><span class="n">save_dir</span> <span class="o">/</span> <span class="n">PROJECT_NAME</span><span class="p">,</span> <span class="n">molecules_ext</span><span class="o">=</span><span class="s2">&quot;.parquet&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="cylindra.widgets.subwidgets.Simulator.simulate_tomogram" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">simulate_tomogram</span><span class="p">(</span><span class="n">components</span><span class="p">,</span> <span class="n">save_dir</span><span class="p">,</span> <span class="n">nsr</span><span class="o">=</span><span class="p">[</span><span class="mf">1.5</span><span class="p">],</span> <span class="n">tilt_range</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">60.0</span><span class="p">,</span> <span class="mf">60.0</span><span class="p">),</span> <span class="n">n_tilt</span><span class="o">=</span><span class="mi">21</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Simulate tomographic images using the current model and save the images.</p>
<p>This function projects the template image to each tilt series, adding
Gaussian noise, and back-projects the noisy tilt series to the tomogram.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>components</code></td>
            <td>
                  <code>list of (str, Path)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of tuples of layer name and path to the template image.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>save_dir</code></td>
            <td>
                  <code><span title="magicclass.types.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the directory where the images will be saved.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>nsr</code></td>
            <td>
                  <code>list of float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Noise-to-signal ratio. It is defined by N/S, where S is the maximum
value of the true monomer density and N is the standard deviation of
the Gaussian noise. Duplicate values are allowed, which is useful
for simulation of multiple images with the same noise level.</p>
              </div>
            </td>
            <td>
                  <code>[1.5]</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>tilt_range</code></td>
            <td>
                  <code>tuple of float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Minimum and maximum tilt angles in degree.</p>
              </div>
            </td>
            <td>
                  <code>(-60.0, 60.0)</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>n_tilt</code></td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of tilt angles between minimum and maximum angles.</p>
              </div>
            </td>
            <td>
                  <code>21</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>interpolation</code></td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Interpolation method used during the simulation.</p>
              </div>
            </td>
            <td>
                  <code>3</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>seed</code></td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Random seed used for the Gaussian noise.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>cylindra/widgets/subwidgets/simulator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@set_design</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">capitalize</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="n">SimulateMenu</span><span class="p">)</span>
<span class="nd">@dask_thread_worker</span><span class="o">.</span><span class="n">with_progress</span><span class="p">(</span><span class="n">descs</span><span class="o">=</span><span class="n">_simulate_tomogram_iter</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">simulate_tomogram</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">components</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;bind&quot;</span><span class="p">:</span> <span class="n">_get_components</span><span class="p">}],</span>
    <span class="n">save_dir</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="n">Path</span><span class="o">.</span><span class="n">Save</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Save at&quot;</span><span class="p">}],</span>
    <span class="n">nsr</span><span class="p">:</span> <span class="n">_NSRatios</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.5</span><span class="p">],</span>
    <span class="n">tilt_range</span><span class="p">:</span> <span class="n">_TiltRange</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mf">60.0</span><span class="p">,</span> <span class="mf">60.0</span><span class="p">),</span>
    <span class="n">n_tilt</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Number of tilts&quot;</span><span class="p">}]</span> <span class="o">=</span> <span class="mi">21</span><span class="p">,</span>
    <span class="n">interpolation</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;choices&quot;</span><span class="p">:</span> <span class="n">INTERPOLATION_CHOICES</span><span class="p">}]</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
    <span class="n">seed</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Annotated</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;min&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;max&quot;</span><span class="p">:</span> <span class="mf">1e8</span><span class="p">}]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>  <span class="c1"># fmt: skip</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Simulate tomographic images using the current model and save the images.</span>

<span class="sd">    This function projects the template image to each tilt series, adding</span>
<span class="sd">    Gaussian noise, and back-projects the noisy tilt series to the tomogram.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    components : list of (str, Path)</span>
<span class="sd">        List of tuples of layer name and path to the template image.</span>
<span class="sd">    save_dir : Path</span>
<span class="sd">        Path to the directory where the images will be saved.</span>
<span class="sd">    nsr : list of float</span>
<span class="sd">        Noise-to-signal ratio. It is defined by N/S, where S is the maximum</span>
<span class="sd">        value of the true monomer density and N is the standard deviation of</span>
<span class="sd">        the Gaussian noise. Duplicate values are allowed, which is useful</span>
<span class="sd">        for simulation of multiple images with the same noise level.</span>
<span class="sd">    tilt_range : tuple of float</span>
<span class="sd">        Minimum and maximum tilt angles in degree.</span>
<span class="sd">    n_tilt : int</span>
<span class="sd">        Number of tilt angles between minimum and maximum angles.</span>
<span class="sd">    interpolation : int</span>
<span class="sd">        Interpolation method used during the simulation.</span>
<span class="sd">    seed : int, optional</span>
<span class="sd">        Random seed used for the Gaussian noise.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">save_dir</span> <span class="o">=</span> <span class="n">_norm_save_dir</span><span class="p">(</span><span class="n">save_dir</span><span class="p">)</span>
    <span class="n">_assert_not_empty</span><span class="p">(</span><span class="n">components</span><span class="p">)</span>
    <span class="n">nsr</span> <span class="o">=</span> <span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">_nsr</span><span class="p">),</span> <span class="mi">4</span><span class="p">)</span> <span class="k">for</span> <span class="n">_nsr</span> <span class="ow">in</span> <span class="n">nsr</span><span class="p">]</span>
    <span class="n">main</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_main</span><span class="p">()</span>
    <span class="n">degrees</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">*</span><span class="n">tilt_range</span><span class="p">,</span> <span class="n">n_tilt</span><span class="p">)</span>
    <span class="n">sino</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prep_radon</span><span class="p">(</span><span class="n">components</span><span class="p">,</span> <span class="n">degrees</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="n">interpolation</span><span class="p">)</span>

    <span class="k">yield</span> <span class="n">_on_radon_finished</span><span class="o">.</span><span class="n">with_args</span><span class="p">(</span><span class="n">sino</span><span class="p">,</span> <span class="n">degrees</span><span class="p">)</span>

    <span class="n">rng</span> <span class="o">=</span> <span class="n">ip</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
    <span class="n">imax</span> <span class="o">=</span> <span class="n">sino</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">nsr_val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">nsr</span><span class="p">):</span>
        <span class="n">sino_noise</span> <span class="o">=</span> <span class="n">sino</span> <span class="o">+</span> <span class="n">rng</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span>
            <span class="n">scale</span><span class="o">=</span><span class="n">imax</span> <span class="o">*</span> <span class="n">nsr_val</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">sino</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="n">sino</span><span class="o">.</span><span class="n">axes</span>
        <span class="p">)</span>
        <span class="n">rec</span> <span class="o">=</span> <span class="n">sino_noise</span><span class="o">.</span><span class="n">iradon</span><span class="p">(</span>
            <span class="n">degrees</span><span class="p">,</span>
            <span class="n">central_axis</span><span class="o">=</span><span class="s2">&quot;y&quot;</span><span class="p">,</span>
            <span class="n">height</span><span class="o">=</span><span class="n">main</span><span class="o">.</span><span class="n">tomogram</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="n">order</span><span class="o">=</span><span class="n">interpolation</span><span class="p">,</span>
        <span class="p">)</span><span class="o">.</span><span class="n">set_scale</span><span class="p">(</span><span class="n">zyx</span><span class="o">=</span><span class="n">main</span><span class="o">.</span><span class="n">tomogram</span><span class="o">.</span><span class="n">scale</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;nm&quot;</span><span class="p">)</span>
        <span class="k">yield</span> <span class="n">_on_iradon_finished</span><span class="o">.</span><span class="n">with_args</span><span class="p">(</span><span class="n">rec</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;N/S = </span><span class="si">{</span><span class="n">nsr_val</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">file_name</span> <span class="o">=</span> <span class="n">save_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;image-</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">.mrc&quot;</span>
        <span class="n">rec</span><span class="o">.</span><span class="n">imsave</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>
        <span class="n">_Logger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Image saved at </span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>

    <span class="n">main</span><span class="o">.</span><span class="n">save_project</span><span class="p">(</span><span class="n">save_dir</span> <span class="o">/</span> <span class="n">PROJECT_NAME</span><span class="p">,</span> <span class="n">molecules_ext</span><span class="o">=</span><span class="s2">&quot;.parquet&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="cylindra.widgets.subwidgets.Simulator.simulate_tomogram_and_open" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">simulate_tomogram_and_open</span><span class="p">(</span><span class="n">components</span><span class="p">,</span> <span class="n">nsr</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">bin_size</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">tilt_range</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">60.0</span><span class="p">,</span> <span class="mf">60.0</span><span class="p">),</span> <span class="n">n_tilt</span><span class="o">=</span><span class="mi">21</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Simulate a tomogram and open the image immediately.</p>
<p>This function projects the template image to each tilt series, adding
Gaussian noise, and back-projects the noisy tilt series to the tomogram.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>components</code></td>
            <td>
                  <code>list of (str, Path)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of tuples of layer name and path to the template image.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>nsr</code></td>
            <td>
                  <code>list of float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Noise-to-signal ratio. It is defined by N/S, where S is the maximum
value of the true monomer density and N is the standard deviation of
the Gaussian noise.</p>
              </div>
            </td>
            <td>
                  <code>1.5</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>bin_size</code></td>
            <td>
                  <code>list of int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Bin sizes used to create multi-scaled images from the simulated image.</p>
              </div>
            </td>
            <td>
                  <code>[1]</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>tilt_range</code></td>
            <td>
                  <code>tuple of float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Minimum and maximum tilt angles in degree.</p>
              </div>
            </td>
            <td>
                  <code>(-60.0, 60.0)</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>n_tilt</code></td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of tilt angles between minimum and maximum angles.</p>
              </div>
            </td>
            <td>
                  <code>21</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>interpolation</code></td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Interpolation method used during the simulation.</p>
              </div>
            </td>
            <td>
                  <code>3</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>seed</code></td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Random seed used for the Gaussian noise.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>cylindra/widgets/subwidgets/simulator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@set_design</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">capitalize</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="n">SimulateMenu</span><span class="p">)</span>
<span class="nd">@dask_thread_worker</span><span class="o">.</span><span class="n">with_progress</span><span class="p">(</span><span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Simulating tomogram...&quot;</span><span class="p">)</span>
<span class="nd">@confirm</span><span class="p">(</span>
    <span class="n">text</span><span class="o">=</span><span class="s2">&quot;You have an opened image. Run anyway?&quot;</span><span class="p">,</span>
    <span class="n">condition</span><span class="o">=</span><span class="s2">&quot;not self._get_main().tomogram.is_dummy&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="k">def</span> <span class="nf">simulate_tomogram_and_open</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">components</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;bind&quot;</span><span class="p">:</span> <span class="n">_get_components</span><span class="p">}],</span>
    <span class="n">nsr</span><span class="p">:</span> <span class="n">_NSRatio</span> <span class="o">=</span> <span class="mf">1.5</span><span class="p">,</span>
    <span class="n">bin_size</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="p">{</span><span class="s2">&quot;options&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;min&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;max&quot;</span><span class="p">:</span> <span class="mi">32</span><span class="p">}}]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span>
    <span class="n">tilt_range</span><span class="p">:</span> <span class="n">_TiltRange</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mf">60.0</span><span class="p">,</span> <span class="mf">60.0</span><span class="p">),</span>
    <span class="n">n_tilt</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Number of tilts&quot;</span><span class="p">}]</span> <span class="o">=</span> <span class="mi">21</span><span class="p">,</span>
    <span class="n">interpolation</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;choices&quot;</span><span class="p">:</span> <span class="n">INTERPOLATION_CHOICES</span><span class="p">}]</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
    <span class="n">seed</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Annotated</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;min&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;max&quot;</span><span class="p">:</span> <span class="mf">1e8</span><span class="p">}]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>  <span class="c1"># fmt: skip</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Simulate a tomogram and open the image immediately.</span>

<span class="sd">    This function projects the template image to each tilt series, adding</span>
<span class="sd">    Gaussian noise, and back-projects the noisy tilt series to the tomogram.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    components : list of (str, Path)</span>
<span class="sd">        List of tuples of layer name and path to the template image.</span>
<span class="sd">    nsr : list of float</span>
<span class="sd">        Noise-to-signal ratio. It is defined by N/S, where S is the maximum</span>
<span class="sd">        value of the true monomer density and N is the standard deviation of</span>
<span class="sd">        the Gaussian noise.</span>
<span class="sd">    bin_size : list of int</span>
<span class="sd">        Bin sizes used to create multi-scaled images from the simulated image.</span>
<span class="sd">    tilt_range : tuple of float</span>
<span class="sd">        Minimum and maximum tilt angles in degree.</span>
<span class="sd">    n_tilt : int</span>
<span class="sd">        Number of tilt angles between minimum and maximum angles.</span>
<span class="sd">    interpolation : int</span>
<span class="sd">        Interpolation method used during the simulation.</span>
<span class="sd">    seed : int, optional</span>
<span class="sd">        Random seed used for the Gaussian noise.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">nsr</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">nsr</span><span class="p">),</span> <span class="mi">4</span><span class="p">)</span>
    <span class="n">_assert_not_empty</span><span class="p">(</span><span class="n">components</span><span class="p">)</span>
    <span class="n">main</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_main</span><span class="p">()</span>
    <span class="n">degrees</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">*</span><span class="n">tilt_range</span><span class="p">,</span> <span class="n">n_tilt</span><span class="p">)</span>
    <span class="n">mole_layers</span> <span class="o">=</span> <span class="p">[</span><span class="n">main</span><span class="o">.</span><span class="n">mole_layers</span><span class="p">[</span><span class="n">layer_name</span><span class="p">]</span> <span class="k">for</span> <span class="n">layer_name</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">components</span><span class="p">]</span>
    <span class="n">sources</span> <span class="o">=</span> <span class="p">[</span><span class="n">layer</span><span class="o">.</span><span class="n">source_spline</span> <span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="n">mole_layers</span><span class="p">]</span>
    <span class="n">sino</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prep_radon</span><span class="p">(</span><span class="n">components</span><span class="p">,</span> <span class="n">degrees</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="n">interpolation</span><span class="p">)</span>

    <span class="k">yield</span> <span class="n">_on_radon_finished</span><span class="o">.</span><span class="n">with_args</span><span class="p">(</span><span class="n">sino</span><span class="p">,</span> <span class="n">degrees</span><span class="p">)</span>

    <span class="n">rng</span> <span class="o">=</span> <span class="n">ip</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
    <span class="n">imax</span> <span class="o">=</span> <span class="n">sino</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="n">sino_noise</span> <span class="o">=</span> <span class="n">sino</span> <span class="o">+</span> <span class="n">rng</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span>
        <span class="n">scale</span><span class="o">=</span><span class="n">imax</span> <span class="o">*</span> <span class="n">nsr</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">sino</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="n">sino</span><span class="o">.</span><span class="n">axes</span>
    <span class="p">)</span>
    <span class="n">rec</span> <span class="o">=</span> <span class="n">sino_noise</span><span class="o">.</span><span class="n">iradon</span><span class="p">(</span>
        <span class="n">degrees</span><span class="p">,</span>
        <span class="n">central_axis</span><span class="o">=</span><span class="s2">&quot;y&quot;</span><span class="p">,</span>
        <span class="n">height</span><span class="o">=</span><span class="n">main</span><span class="o">.</span><span class="n">tomogram</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
        <span class="n">order</span><span class="o">=</span><span class="n">interpolation</span><span class="p">,</span>
    <span class="p">)</span><span class="o">.</span><span class="n">set_scale</span><span class="p">(</span><span class="n">zyx</span><span class="o">=</span><span class="n">sino</span><span class="o">.</span><span class="n">scale</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;nm&quot;</span><span class="p">)</span>
    <span class="k">yield</span> <span class="n">_on_iradon_finished</span><span class="o">.</span><span class="n">with_args</span><span class="p">(</span><span class="n">rec</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;N/S = </span><span class="si">{</span><span class="n">nsr</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">rec</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">SIMULATED_IMAGE_NAME</span>
    <span class="n">tomo</span> <span class="o">=</span> <span class="n">CylTomogram</span><span class="o">.</span><span class="n">from_image</span><span class="p">(</span>
        <span class="n">rec</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">sino</span><span class="o">.</span><span class="n">scale</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">tilt</span><span class="o">=</span><span class="n">tilt_range</span><span class="p">,</span> <span class="n">binsize</span><span class="o">=</span><span class="n">bin_size</span>
    <span class="p">)</span>
    <span class="n">tomo</span><span class="o">.</span><span class="n">splines</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">sources</span><span class="p">)</span>
    <span class="k">yield</span> <span class="n">main</span><span class="o">.</span><span class="n">_send_tomogram_to_viewer</span><span class="o">.</span><span class="n">with_args</span><span class="p">(</span><span class="n">tomo</span><span class="p">)</span>

    <span class="nd">@thread_worker</span><span class="o">.</span><span class="n">callback</span>
    <span class="k">def</span> <span class="nf">_on_return</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">layer</span><span class="p">,</span> <span class="n">source_spline</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">mole_layers</span><span class="p">,</span> <span class="n">sources</span><span class="p">,</span> <span class="n">strict</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
            <span class="n">main</span><span class="o">.</span><span class="n">parent_viewer</span><span class="o">.</span><span class="n">add_layer</span><span class="p">(</span><span class="n">layer</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">source_spline</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">layer</span><span class="o">.</span><span class="n">source_component</span> <span class="o">=</span> <span class="n">source_spline</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">main</span><span class="o">.</span><span class="n">splines</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">main</span><span class="o">.</span><span class="n">_update_splines_in_images</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">_on_return</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="cylindra.widgets.subwidgets.Simulator.simulate_tomogram_from_tilt_series" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">simulate_tomogram_from_tilt_series</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">nsr</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">bin_size</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">tilt_range</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">60.0</span><span class="p">,</span> <span class="mf">60.0</span><span class="p">),</span> <span class="n">height</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Simulate tomographic images using a tilt series.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>path</code></td>
            <td>
                  <code><span title="magicclass.types.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the tilt series image.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>nsr</code></td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#float">float</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Noise-to-signal ratio. It is defined by N/S, where S is the maximum
value of the tilt series. If the input image is already noisy, you
can set this value to zero to avoid adding more noises.</p>
              </div>
            </td>
            <td>
                  <code>1.5</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>bin_size</code></td>
            <td>
                  <code>list of int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Bin sizes used to create multi-scaled images from the simulated image.</p>
              </div>
            </td>
            <td>
                  <code>[1]</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>tilt_range</code></td>
            <td>
                  <code>tuple of float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Minimum and maximum tilt angles in degree.</p>
              </div>
            </td>
            <td>
                  <code>(-60.0, 60.0)</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>height</code></td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Height of the simulated tomogram in nm.</p>
              </div>
            </td>
            <td>
                  <code>50</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>interpolation</code></td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Interpolation method used during the simulation.</p>
              </div>
            </td>
            <td>
                  <code>3</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>seed</code></td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Random seed used for the Gaussian noise.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>cylindra/widgets/subwidgets/simulator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@set_design</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">capitalize</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="n">SimulateMenu</span><span class="p">)</span>
<span class="nd">@dask_thread_worker</span><span class="o">.</span><span class="n">with_progress</span><span class="p">(</span><span class="n">descs</span><span class="o">=</span><span class="n">_simulate_tomogram_from_tilt_iter</span><span class="p">)</span>
<span class="nd">@confirm</span><span class="p">(</span>
    <span class="n">text</span><span class="o">=</span><span class="s2">&quot;You have an opened image. Run anyway?&quot;</span><span class="p">,</span>
    <span class="n">condition</span><span class="o">=</span><span class="s2">&quot;not self._get_main().tomogram.is_dummy&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="k">def</span> <span class="nf">simulate_tomogram_from_tilt_series</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">path</span><span class="p">:</span> <span class="n">Path</span><span class="o">.</span><span class="n">Read</span><span class="p">[</span><span class="n">FileFilter</span><span class="o">.</span><span class="n">IMAGE</span><span class="p">],</span>
    <span class="n">nsr</span><span class="p">:</span> <span class="n">_NSRatio</span> <span class="o">=</span> <span class="mf">1.5</span><span class="p">,</span>
    <span class="n">bin_size</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="p">{</span><span class="s2">&quot;options&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;min&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;max&quot;</span><span class="p">:</span> <span class="mi">32</span><span class="p">}}]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span>
    <span class="n">tilt_range</span><span class="p">:</span> <span class="n">_TiltRange</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mf">60.0</span><span class="p">,</span> <span class="mf">60.0</span><span class="p">),</span>
    <span class="n">height</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="n">nm</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;height (nm)&quot;</span><span class="p">}]</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
    <span class="n">interpolation</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;choices&quot;</span><span class="p">:</span> <span class="n">INTERPOLATION_CHOICES</span><span class="p">}]</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
    <span class="n">seed</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Annotated</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;min&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;max&quot;</span><span class="p">:</span> <span class="mf">1e8</span><span class="p">}]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Simulate tomographic images using a tilt series.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    path : Path</span>
<span class="sd">        Path to the tilt series image.</span>
<span class="sd">    nsr : float</span>
<span class="sd">        Noise-to-signal ratio. It is defined by N/S, where S is the maximum</span>
<span class="sd">        value of the tilt series. If the input image is already noisy, you</span>
<span class="sd">        can set this value to zero to avoid adding more noises.</span>
<span class="sd">    bin_size : list of int</span>
<span class="sd">        Bin sizes used to create multi-scaled images from the simulated image.</span>
<span class="sd">    tilt_range : tuple of float</span>
<span class="sd">        Minimum and maximum tilt angles in degree.</span>
<span class="sd">    height : int</span>
<span class="sd">        Height of the simulated tomogram in nm.</span>
<span class="sd">    interpolation : int</span>
<span class="sd">        Interpolation method used during the simulation.</span>
<span class="sd">    seed : int, optional</span>
<span class="sd">        Random seed used for the Gaussian noise.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">main</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_main</span><span class="p">()</span>
    <span class="n">sino</span> <span class="o">=</span> <span class="n">ip</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="n">scale</span> <span class="o">=</span> <span class="n">sino</span><span class="o">.</span><span class="n">scale</span><span class="o">.</span><span class="n">x</span>
    <span class="k">if</span> <span class="n">sino</span><span class="o">.</span><span class="n">ndim</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Input image must be a 3D image.&quot;</span><span class="p">)</span>
    <span class="n">degrees</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">*</span><span class="n">tilt_range</span><span class="p">,</span> <span class="n">sino</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">rng</span> <span class="o">=</span> <span class="n">ip</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
    <span class="n">imax</span> <span class="o">=</span> <span class="n">sino</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="n">sino_noise</span> <span class="o">=</span> <span class="n">sino</span> <span class="o">+</span> <span class="n">rng</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span>
        <span class="n">scale</span><span class="o">=</span><span class="n">imax</span> <span class="o">*</span> <span class="n">nsr</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">sino</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="n">sino</span><span class="o">.</span><span class="n">axes</span>
    <span class="p">)</span>
    <span class="k">yield</span> <span class="n">thread_worker</span><span class="o">.</span><span class="n">callback</span><span class="p">()</span>
    <span class="n">rec</span> <span class="o">=</span> <span class="n">sino_noise</span><span class="o">.</span><span class="n">iradon</span><span class="p">(</span>
        <span class="n">degrees</span><span class="p">,</span>
        <span class="n">central_axis</span><span class="o">=</span><span class="s2">&quot;y&quot;</span><span class="p">,</span>
        <span class="n">height</span><span class="o">=</span><span class="n">roundint</span><span class="p">(</span><span class="n">height</span> <span class="o">/</span> <span class="n">scale</span><span class="p">),</span>
        <span class="n">order</span><span class="o">=</span><span class="n">interpolation</span><span class="p">,</span>
    <span class="p">)</span><span class="o">.</span><span class="n">set_scale</span><span class="p">(</span><span class="n">zyx</span><span class="o">=</span><span class="n">scale</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;nm&quot;</span><span class="p">)</span>
    <span class="k">yield</span> <span class="n">_on_iradon_finished</span><span class="o">.</span><span class="n">with_args</span><span class="p">(</span><span class="n">rec</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;N/S = </span><span class="si">{</span><span class="n">nsr</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">rec</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">SIMULATED_IMAGE_NAME</span>
    <span class="n">tomo</span> <span class="o">=</span> <span class="n">CylTomogram</span><span class="o">.</span><span class="n">from_image</span><span class="p">(</span>
        <span class="n">rec</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="p">,</span> <span class="n">tilt</span><span class="o">=</span><span class="n">tilt_range</span><span class="p">,</span> <span class="n">binsize</span><span class="o">=</span><span class="n">bin_size</span>
    <span class="p">)</span>
    <span class="n">main</span><span class="o">.</span><span class="n">_macro_offset</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">main</span><span class="o">.</span><span class="n">macro</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">main</span><span class="o">.</span><span class="n">_send_tomogram_to_viewer</span><span class="o">.</span><span class="n">with_args</span><span class="p">(</span><span class="n">tomo</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="cylindra.widgets.subwidgets.Simulator.twist" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">twist</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="n">by</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">yrange</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">arange</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">allev</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Apply local twist to molecules.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>layer</code></td>
            <td>
                  <code><span title="cylindra._napari.MoleculesLayer">MoleculesLayer</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Layer to be transformed.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>by</code></td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#float">float</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Amount of twist in degree.</p>
              </div>
            </td>
            <td>
                  <code>0.0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>yrange</code></td>
            <td>
                  <code>tuple of int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Range of Y axis to be transformed. Range is [a, b).</p>
              </div>
            </td>
            <td>
                  <code>(0, 1)</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>arange</code></td>
            <td>
                  <code>tuple of int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Range of angle axis to be transformed. Range is [a, b).</p>
              </div>
            </td>
            <td>
                  <code>(0, 1)</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>allev</code></td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Alleviation of the local expansion. If true, the surrounding molecules
will be shifted to alleviate the local expansion.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>cylindra/widgets/subwidgets/simulator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@set_design</span><span class="p">(</span><span class="n">icon</span><span class="o">=</span><span class="s2">&quot;mingcute:rotate-x-line&quot;</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="n">SimulatorTools</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">twist</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">layer</span><span class="p">:</span> <span class="n">_ModeledMoleculesLayer</span><span class="p">,</span>
    <span class="n">by</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;min&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="s2">&quot;max&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">}]</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
    <span class="n">yrange</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="p">{</span><span class="s2">&quot;widget_type&quot;</span><span class="p">:</span> <span class="n">RangeSlider</span><span class="p">}]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
    <span class="n">arange</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="p">{</span><span class="s2">&quot;widget_type&quot;</span><span class="p">:</span> <span class="n">RangeSlider</span><span class="p">}]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
    <span class="n">allev</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Apply local twist to molecules.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    layer : MoleculesLayer</span>
<span class="sd">        Layer to be transformed.</span>
<span class="sd">    by : float</span>
<span class="sd">        Amount of twist in degree.</span>
<span class="sd">    yrange : tuple of int</span>
<span class="sd">        Range of Y axis to be transformed. Range is [a, b).</span>
<span class="sd">    arange : tuple of int</span>
<span class="sd">        Range of angle axis to be transformed. Range is [a, b).</span>
<span class="sd">    allev : bool</span>
<span class="sd">        Alleviation of the local expansion. If true, the surrounding molecules</span>
<span class="sd">        will be shifted to alleviate the local expansion.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">layer</span> <span class="o">=</span> <span class="n">assert_layer</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent_viewer</span><span class="p">)</span>
    <span class="n">spl</span><span class="p">,</span> <span class="n">model</span> <span class="o">=</span> <span class="n">_local_transform</span><span class="p">(</span>
        <span class="n">CylinderModel</span><span class="o">.</span><span class="n">twist</span><span class="p">,</span> <span class="n">layer</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">by</span><span class="p">),</span> <span class="n">yrange</span><span class="p">,</span> <span class="n">arange</span><span class="p">,</span> <span class="n">allev</span>
    <span class="p">)</span>
    <span class="n">layer</span><span class="o">.</span><span class="n">molecules</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">to_molecules</span><span class="p">(</span><span class="n">spl</span><span class="p">,</span> <span class="n">layer</span><span class="o">.</span><span class="n">molecules</span><span class="o">.</span><span class="n">features</span><span class="p">)</span>
    <span class="n">_set_simulation_model</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../sta/" class="md-footer__link md-footer__link--prev" aria-label="Previous: cylindra.widgets.sta.SubtomogramAveraging">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                cylindra.widgets.sta.SubtomogramAveraging
              </div>
            </div>
          </a>
        
        
          
          <a href="../batch/" class="md-footer__link md-footer__link--next" aria-label="Next: cylindra.widgets.batch">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                cylindra.widgets.batch
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright (c) 2023 - 2024 Hanjin Liu
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["content.code.annotate", "navigation.sections", "navigation.indexes", "navigation.footer", "toc.follow", "search.suggest", "search.share"], "search": "../../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.ad660dcc.min.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>